<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/node-feature-discovery/master/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/node-feature-discovery/master/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav > ul.nav-list:first-child > li > a, .site-nav > ul.nav-list:first-child > li > ul > li:not(:nth-child(2)) > a, .site-nav > ul.nav-list:first-child > li > ul > li > ul > li a { background-image: none; } .site-nav > ul.nav-list:not(:first-child) a, .site-nav li.external a { background-image: none; } .site-nav > ul.nav-list:first-child > li:nth-child(2) > ul > li:nth-child(2) > a { font-weight: 600; text-decoration: none; }.site-nav > ul.nav-list:first-child > li:nth-child(2) > button svg, .site-nav > ul.nav-list:first-child > li:nth-child(2) > ul > li:nth-child(2) > button svg { transform: rotate(-90deg); }.site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(2) > ul.nav-list, .site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(2) > ul.nav-list > li.nav-list-item:nth-child(2) > ul.nav-list { display: block; } </style> <script src="/node-feature-discovery/master/assets/js/vendor/lunr.min.js"></script> <script src="/node-feature-discovery/master/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Kustomize | Node Feature Discovery</title> <meta name="generator" content="Jekyll v3.10.0" /> <meta property="og:title" content="Kustomize" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Documentation of Node Feature Discovery - a Kubernetes add-on for discovering and advertising hardware features and system configuration in the cluster." /> <meta property="og:description" content="Documentation of Node Feature Discovery - a Kubernetes add-on for discovering and advertising hardware features and system configuration in the cluster." /> <link rel="canonical" href="https://kubernetes-sigs.github.com/node-feature-discovery/master/deployment/kustomize.html" /> <meta property="og:url" content="https://kubernetes-sigs.github.com/node-feature-discovery/master/deployment/kustomize.html" /> <meta property="og:site_name" content="Node Feature Discovery" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Kustomize" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Documentation of Node Feature Discovery - a Kubernetes add-on for discovering and advertising hardware features and system configuration in the cluster.","headline":"Kustomize","url":"https://kubernetes-sigs.github.com/node-feature-discovery/master/deployment/kustomize.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/node-feature-discovery/master/" class="site-title lh-tight"> Node Feature Discovery </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Get started category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/node-feature-discovery/master/get-started/" class="nav-list-link">Get started</a><ul class="nav-list"><li class="nav-list-item"><a href="/node-feature-discovery/master/get-started/introduction.html" class="nav-list-link">Introduction</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/get-started/quick-start.html" class="nav-list-link">Quick start</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Deployment category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/node-feature-discovery/master/deployment/" class="nav-list-link">Deployment</a><ul class="nav-list"><li class="nav-list-item"><a href="/node-feature-discovery/master/deployment/image-variants.html" class="nav-list-link">Image variants</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/deployment/kustomize.html" class="nav-list-link">Kustomize</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/deployment/helm.html" class="nav-list-link">Helm</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/deployment/operator.html" class="nav-list-link">NFD Operator</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/deployment/uninstallation.html" class="nav-list-link">Uninstallation</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/deployment/metrics.html" class="nav-list-link">Metrics</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Usage category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/node-feature-discovery/master/usage/" class="nav-list-link">Usage</a><ul class="nav-list"><li class="nav-list-item"><a href="/node-feature-discovery/master/usage/features.html" class="nav-list-link">Feature labels</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/usage/using-labels.html" class="nav-list-link">Using node labels</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/usage/nfd-master.html" class="nav-list-link">NFD-Master</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/usage/nfd-worker.html" class="nav-list-link">NFD-Worker</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/usage/nfd-topology-updater.html" class="nav-list-link">NFD-Topology-Updater</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/usage/nfd-gc.html" class="nav-list-link">NFD-Garbage-Collector</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/usage/custom-resources.html" class="nav-list-link">CRDs</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/usage/customization-guide.html" class="nav-list-link">Customization guide</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/usage/examples-and-demos.html" class="nav-list-link">Examples and demos</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/usage/kubectl-plugin.html" class="nav-list-link">Kubectl plugin</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/usage/image-compatibility.html" class="nav-list-link">Image Compatibility Artifact</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Reference category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/node-feature-discovery/master/reference/" class="nav-list-link">Reference</a><ul class="nav-list"><li class="nav-list-item"><a href="/node-feature-discovery/master/reference/master-commandline-reference.html" class="nav-list-link">Master cmdline reference</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/reference/worker-commandline-reference.html" class="nav-list-link">Worker cmdline reference</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/reference/master-configuration-reference.html" class="nav-list-link">Master config reference</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/reference/worker-configuration-reference.html" class="nav-list-link">Worker config reference</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/reference/topology-updater-commandline-reference.html" class="nav-list-link">Topology Updater Cmdline Reference</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/reference/topology-updater-configuration-reference.html" class="nav-list-link">Topology-Updater config reference</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/reference/gc-commandline-reference.html" class="nav-list-link">Garbage Collector Cmdline Reference</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/reference/plugin-commandline-reference.html" class="nav-list-link">Kubectl plugin cmdline reference</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/reference/node-feature-client-reference.html" class="nav-list-link">Node Feature client cmdline reference</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/reference/versions.html" class="nav-list-link">Versions</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/reference/feature-gates.html" class="nav-list-link">Feature Gates</a></li></ul></li><li class="nav-list-item"><a href="/node-feature-discovery/master/developer-guide/" class="nav-list-link">Developer guide</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/contributing/" class="nav-list-link">Contributing</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Node Feature Discovery" aria-label="Search Node Feature Discovery" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <div class="version-dropdown"> <label for="versions">Version:</label> <select id="versions" onchange="location = this.value;"> <script src="/node-feature-discovery/versions.js"></script> <script> var select = document.getElementById('versions'); var items = getVersionListItems(); for (var i=0; i < items.length; i++) { var opt = document.createElement('option'); opt.appendChild(document.createTextNode(items[i].name)); opt.value = items[i].url; select.appendChild(opt); } </script> </select> </div> </div> <div class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/node-feature-discovery/master/deployment/">Deployment</a></li> <li class="breadcrumb-nav-list-item"><span>Kustomize</span></li> </ol> </nav> <div id="main-content" class="main-content"> <main> <h1 class="no_toc" id="deployment-with-kustomize"> <a href="#deployment-with-kustomize" class="anchor-heading" aria-labelledby="deployment-with-kustomize"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Deployment with Kustomize </h1> <h2 class="no_toc text-delta" id="table-of-contents"> <a href="#table-of-contents" class="anchor-heading" aria-labelledby="table-of-contents"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Table of contents </h2> <ol id="markdown-toc"> <li><a href="#overlays" id="markdown-toc-overlays">Overlays</a> <ol> <li><a href="#worker-one-shot" id="markdown-toc-worker-one-shot">Worker one-shot</a></li> <li><a href="#master-worker-topologyupdater" id="markdown-toc-master-worker-topologyupdater">Master Worker Topologyupdater</a></li> <li><a href="#topologyupdater" id="markdown-toc-topologyupdater">Topologyupdater</a></li> <li><a href="#metrics" id="markdown-toc-metrics">Metrics</a></li> </ol> </li> <li><a href="#uninstallation" id="markdown-toc-uninstallation">Uninstallation</a></li> </ol><hr /> <p><a href="https://github.com/kubernetes-sigs/kustomize">Kustomize</a> can be used to deploy NFD. Customization of the deployment is done by maintaining declarative overlays on top of the base overlays in NFD.</p> <p>To follow the deployment instructions here, <a href="https://kubernetes.io/docs/tasks/tools/install-kubectl">kubectl</a> v1.24 or later is required.</p> <p>The kustomize overlays provided in the repo can be used directly:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl apply <span class="nt">-k</span> <span class="s2">"https://github.com/kubernetes-sigs/node-feature-discovery/deployment/overlays/default?ref=master"</span>
</code></pre></div></div> <p>This will required RBAC rules and deploy nfd-master (as a deployment) and nfd-worker (as daemonset) in the <code class="language-plaintext highlighter-rouge">node-feature-discovery</code> namespace.</p> <blockquote> <p><strong>NOTE:</strong> nfd-topology-updater is not deployed as part of the <code class="language-plaintext highlighter-rouge">default</code> overlay. Refer to the <a href="#master-worker-topologyupdater">Master Worker Topologyupdater</a> and <a href="#topologyupdater">Topologyupdater</a> below.</p> </blockquote> <p>Alternatively you can clone the repository and customize the deployment by creating your own overlays. See <a href="https://github.com/kubernetes-sigs/kustomize">kustomize</a> for more information about managing deployment configurations.</p> <h2 id="overlays"> <a href="#overlays" class="anchor-heading" aria-labelledby="overlays"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Overlays </h2> <p>The NFD repository hosts a set of overlays for different usages and deployment scenarios under <a href="https://github.com/kubernetes-sigs/node-feature-discovery/blob/master/deployment/overlays"><code class="language-plaintext highlighter-rouge">deployment/overlays</code></a></p> <ul> <li><a href="https://github.com/kubernetes-sigs/node-feature-discovery/blob/master/deployment/overlays/default"><code class="language-plaintext highlighter-rouge">default</code></a>: default deployment of nfd-worker as a daemonset, described above</li> <li><a href="https://github.com/kubernetes-sigs/node-feature-discovery/blob/master/deployment/overlays/default-job"><code class="language-plaintext highlighter-rouge">default-job</code></a>: see <a href="#worker-one-shot">Worker one-shot</a> below</li> <li><a href="https://github.com/kubernetes-sigs/node-feature-discovery/blob/master/deployment/overlays/master-worker-topologyupdater"><code class="language-plaintext highlighter-rouge">master-worker-topologyupdater</code></a>: see <a href="#master-worker-topologyupdater">Master Worker Topologyupdater</a> below</li> <li><a href="https://github.com/kubernetes-sigs/node-feature-discovery/blob/master/deployment/overlays/topologyupdater"><code class="language-plaintext highlighter-rouge">topologyupdater</code></a>: see <a href="#topologyupdater">Topology Updater</a> below</li> <li><a href="https://github.com/kubernetes-sigs/node-feature-discovery/blob/master/deployment/overlays/prometheus"><code class="language-plaintext highlighter-rouge">prometheus</code></a>: see <a href="#metrics">Metrics</a> below</li> <li><a href="https://github.com/kubernetes-sigs/node-feature-discovery/blob/master/deployment/overlays/prune"><code class="language-plaintext highlighter-rouge">prune</code></a>: clean up the cluster after uninstallation, see <a href="/node-feature-discovery/master/deployment/uninstallation.html#removing-feature-labels">Removing feature labels</a></li> <li><a href="https://github.com/kubernetes-sigs/node-feature-discovery/blob/master/deployment/overlays/samples/custom-rules"><code class="language-plaintext highlighter-rouge">samples/custom-rules</code></a>: an example for spicing up the default deployment with a separately managed configmap of custom labeling rules, see <a href="/node-feature-discovery/master/usage/features.html#custom">Custom feature source</a> for more information about custom node labels</li> </ul> <h3 id="worker-one-shot"> <a href="#worker-one-shot" class="anchor-heading" aria-labelledby="worker-one-shot"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Worker one-shot </h3> <p>Feature discovery can alternatively be configured as a one-shot job. The <code class="language-plaintext highlighter-rouge">default-job</code> overlay may be used to achieve this:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">NUM_NODES</span><span class="o">=</span><span class="si">$(</span>kubectl get no <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">=</span><span class="s1">'{.items[*].metadata.name}'</span> | <span class="nb">wc</span> <span class="nt">-w</span><span class="si">)</span>
kubectl kustomize <span class="s2">"https://github.com/kubernetes-sigs/node-feature-discovery/deployment/overlays/default-job?ref=master"</span> | <span class="se">\</span>
    <span class="nb">sed </span>s<span class="s2">"/NUM_NODES/</span><span class="nv">$NUM_NODES</span><span class="s2">/"</span> | <span class="se">\</span>
    kubectl apply <span class="nt">-f</span> -
</code></pre></div></div> <p>The example above launches as many jobs as there are non-master nodes. Note that this approach does not guarantee running once on every node. For example, tainted, non-ready nodes or some other reasons in Job scheduling may cause some node(s) will run extra job instance(s) to satisfy the request.</p> <h3 id="master-worker-topologyupdater"> <a href="#master-worker-topologyupdater" class="anchor-heading" aria-labelledby="master-worker-topologyupdater"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Master Worker Topologyupdater </h3> <p>NFD-Master, nfd-worker and nfd-topology-updater can be configured to be deployed as separate pods. The <code class="language-plaintext highlighter-rouge">master-worker-topologyupdater</code> overlay may be used to achieve this:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl apply <span class="nt">-k</span> <span class="s2">"https://github.com/kubernetes-sigs/node-feature-discovery/deployment/overlays/master-worker-topologyupdater?ref=master"</span>

</code></pre></div></div> <h3 id="topologyupdater"> <a href="#topologyupdater" class="anchor-heading" aria-labelledby="topologyupdater"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Topologyupdater </h3> <p>To deploy just nfd-topology-updater (without nfd-master and nfd-worker) use the <code class="language-plaintext highlighter-rouge">topologyupdater</code> overlay:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl apply <span class="nt">-k</span> <span class="s2">"https://github.com/kubernetes-sigs/node-feature-discovery/deployment/overlays/topologyupdater?ref=master"</span>

</code></pre></div></div> <p>NFD-Topology-Updater can be configured along with the <code class="language-plaintext highlighter-rouge">default</code> overlay (which deploys nfd-worker and nfd-master) where all the software components are deployed as separate pods;</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
kubectl apply <span class="nt">-k</span> <span class="s2">"https://github.com/kubernetes-sigs/node-feature-discovery/deployment/overlays/default?ref=master"</span>
kubectl apply <span class="nt">-k</span> <span class="s2">"https://github.com/kubernetes-sigs/node-feature-discovery/deployment/overlays/topologyupdater?ref=master"</span>

</code></pre></div></div> <h3 id="metrics"> <a href="#metrics" class="anchor-heading" aria-labelledby="metrics"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Metrics </h3> <p>To allow <a href="https://github.com/prometheus-operator/prometheus-operator">prometheus operator</a> to scrape metrics from node-feature-discovery, run the following command:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl apply <span class="nt">-k</span> <span class="s2">"https://github.com/kubernetes-sigs/node-feature-discovery/deployment/overlays/default?ref=master"</span>
kubectl apply <span class="nt">-k</span> <span class="s2">"https://github.com/kubernetes-sigs/node-feature-discovery/deployment/overlays/prometheus?ref=master"</span>
</code></pre></div></div> <h2 id="uninstallation"> <a href="#uninstallation" class="anchor-heading" aria-labelledby="uninstallation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Uninstallation </h2> <p>Simplest way is to invoke <code class="language-plaintext highlighter-rouge">kubectl delete</code> on the overlay that was used for deployment. Beware that this will also delete the namespace that NFD is running in. For example, in case the default overlay from the repo was used:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl delete <span class="nt">-k</span> https://github.com/kubernetes-sigs/node-feature-discovery/deployment/overlays/default?ref<span class="o">=</span>master
</code></pre></div></div> <p>Alternatively you can delete create objects one-by-one, depending on the type of deployment, for example:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">NFD_NS</span><span class="o">=</span>node-feature-discovery
kubectl <span class="nt">-n</span> <span class="nv">$NFD_NS</span> delete ds nfd-worker
kubectl <span class="nt">-n</span> <span class="nv">$NFD_NS</span> delete deploy nfd-master
kubectl <span class="nt">-n</span> <span class="nv">$NFD_NS</span> delete svc nfd-master
kubectl <span class="nt">-n</span> <span class="nv">$NFD_NS</span> delete sa nfd-master
kubectl delete clusterrole nfd-master
kubectl delete clusterrolebinding nfd-master
</code></pre></div></div> <!-- Links --> </main> </div> </div> <div class="search-overlay"></div> </div> </body> </html>

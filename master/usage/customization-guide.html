<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/node-feature-discovery/master/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/node-feature-discovery/master/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav > ul.nav-list:first-child > li > a, .site-nav > ul.nav-list:first-child > li > ul > li:not(:nth-child(8)) > a, .site-nav > ul.nav-list:first-child > li > ul > li > ul > li a { background-image: none; } .site-nav > ul.nav-list:not(:first-child) a, .site-nav li.external a { background-image: none; } .site-nav > ul.nav-list:first-child > li:nth-child(3) > ul > li:nth-child(8) > a { font-weight: 600; text-decoration: none; }.site-nav > ul.nav-list:first-child > li:nth-child(3) > button svg, .site-nav > ul.nav-list:first-child > li:nth-child(3) > ul > li:nth-child(8) > button svg { transform: rotate(-90deg); }.site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(3) > ul.nav-list, .site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(3) > ul.nav-list > li.nav-list-item:nth-child(8) > ul.nav-list { display: block; } </style> <script src="/node-feature-discovery/master/assets/js/vendor/lunr.min.js"></script> <script src="/node-feature-discovery/master/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Customization guide | Node Feature Discovery</title> <meta name="generator" content="Jekyll v3.10.0" /> <meta property="og:title" content="Customization guide" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Documentation of Node Feature Discovery - a Kubernetes add-on for discovering and advertising hardware features and system configuration in the cluster." /> <meta property="og:description" content="Documentation of Node Feature Discovery - a Kubernetes add-on for discovering and advertising hardware features and system configuration in the cluster." /> <link rel="canonical" href="https://kubernetes-sigs.github.com/node-feature-discovery/master/usage/customization-guide.html" /> <meta property="og:url" content="https://kubernetes-sigs.github.com/node-feature-discovery/master/usage/customization-guide.html" /> <meta property="og:site_name" content="Node Feature Discovery" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Customization guide" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Documentation of Node Feature Discovery - a Kubernetes add-on for discovering and advertising hardware features and system configuration in the cluster.","headline":"Customization guide","url":"https://kubernetes-sigs.github.com/node-feature-discovery/master/usage/customization-guide.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/node-feature-discovery/master/" class="site-title lh-tight"> Node Feature Discovery </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Get started category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/node-feature-discovery/master/get-started/" class="nav-list-link">Get started</a><ul class="nav-list"><li class="nav-list-item"><a href="/node-feature-discovery/master/get-started/introduction.html" class="nav-list-link">Introduction</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/get-started/quick-start.html" class="nav-list-link">Quick start</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Deployment category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/node-feature-discovery/master/deployment/" class="nav-list-link">Deployment</a><ul class="nav-list"><li class="nav-list-item"><a href="/node-feature-discovery/master/deployment/image-variants.html" class="nav-list-link">Image variants</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/deployment/kustomize.html" class="nav-list-link">Kustomize</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/deployment/helm.html" class="nav-list-link">Helm</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/deployment/operator.html" class="nav-list-link">NFD Operator</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/deployment/uninstallation.html" class="nav-list-link">Uninstallation</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/deployment/metrics.html" class="nav-list-link">Metrics</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Usage category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/node-feature-discovery/master/usage/" class="nav-list-link">Usage</a><ul class="nav-list"><li class="nav-list-item"><a href="/node-feature-discovery/master/usage/features.html" class="nav-list-link">Feature labels</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/usage/using-labels.html" class="nav-list-link">Using node labels</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/usage/nfd-master.html" class="nav-list-link">NFD-Master</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/usage/nfd-worker.html" class="nav-list-link">NFD-Worker</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/usage/nfd-topology-updater.html" class="nav-list-link">NFD-Topology-Updater</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/usage/nfd-gc.html" class="nav-list-link">NFD-Garbage-Collector</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/usage/custom-resources.html" class="nav-list-link">CRDs</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/usage/customization-guide.html" class="nav-list-link">Customization guide</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/usage/examples-and-demos.html" class="nav-list-link">Examples and demos</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/usage/kubectl-plugin.html" class="nav-list-link">Kubectl plugin</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/usage/image-compatibility.html" class="nav-list-link">Image Compatibility Artifact</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Reference category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/node-feature-discovery/master/reference/" class="nav-list-link">Reference</a><ul class="nav-list"><li class="nav-list-item"><a href="/node-feature-discovery/master/reference/master-commandline-reference.html" class="nav-list-link">Master cmdline reference</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/reference/worker-commandline-reference.html" class="nav-list-link">Worker cmdline reference</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/reference/master-configuration-reference.html" class="nav-list-link">Master config reference</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/reference/worker-configuration-reference.html" class="nav-list-link">Worker config reference</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/reference/topology-updater-commandline-reference.html" class="nav-list-link">Topology Updater Cmdline Reference</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/reference/topology-updater-configuration-reference.html" class="nav-list-link">Topology-Updater config reference</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/reference/gc-commandline-reference.html" class="nav-list-link">Garbage Collector Cmdline Reference</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/reference/plugin-commandline-reference.html" class="nav-list-link">Kubectl plugin cmdline reference</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/reference/node-feature-client-reference.html" class="nav-list-link">Node Feature client cmdline reference</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/reference/versions.html" class="nav-list-link">Versions</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/reference/feature-gates.html" class="nav-list-link">Feature Gates</a></li></ul></li><li class="nav-list-item"><a href="/node-feature-discovery/master/developer-guide/" class="nav-list-link">Developer guide</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/contributing/" class="nav-list-link">Contributing</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Node Feature Discovery" aria-label="Search Node Feature Discovery" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <div class="version-dropdown"> <label for="versions">Version:</label> <select id="versions" onchange="location = this.value;"> <script src="/node-feature-discovery/versions.js"></script> <script> var select = document.getElementById('versions'); var items = getVersionListItems(); for (var i=0; i < items.length; i++) { var opt = document.createElement('option'); opt.appendChild(document.createTextNode(items[i].name)); opt.value = items[i].url; select.appendChild(opt); } </script> </select> </div> </div> <div class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/node-feature-discovery/master/usage/">Usage</a></li> <li class="breadcrumb-nav-list-item"><span>Customization guide</span></li> </ol> </nav> <div id="main-content" class="main-content"> <main> <h1 class="no_toc" id="customization-guide"> <a href="#customization-guide" class="anchor-heading" aria-labelledby="customization-guide"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Customization guide </h1> <h2 class="no_toc text-delta" id="table-of-contents"> <a href="#table-of-contents" class="anchor-heading" aria-labelledby="table-of-contents"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Table of contents </h2> <ol id="markdown-toc"> <li><a href="#overview" id="markdown-toc-overview">Overview</a></li> <li><a href="#nodefeature-custom-resource" id="markdown-toc-nodefeature-custom-resource">NodeFeature custom resource</a> <ol> <li><a href="#a-nodefeature-example" id="markdown-toc-a-nodefeature-example">A NodeFeature example</a></li> <li><a href="#feature-types" id="markdown-toc-feature-types">Feature types</a></li> </ol> </li> <li><a href="#nodefeaturerule-custom-resource" id="markdown-toc-nodefeaturerule-custom-resource">NodeFeatureRule custom resource</a> <ol> <li><a href="#a-nodefeaturerule-example" id="markdown-toc-a-nodefeaturerule-example">A NodeFeatureRule example</a></li> <li><a href="#node-tainting" id="markdown-toc-node-tainting">Node tainting</a></li> </ol> </li> <li><a href="#nodefeaturegroup-custom-resource" id="markdown-toc-nodefeaturegroup-custom-resource">NodeFeatureGroup custom resource</a> <ol> <li><a href="#a-nodefeaturegroup-example" id="markdown-toc-a-nodefeaturegroup-example">A NodeFeatureGroup example</a></li> </ol> </li> <li><a href="#local-feature-source" id="markdown-toc-local-feature-source">Local feature source</a> <ol> <li><a href="#an-example" id="markdown-toc-an-example">An example</a></li> <li><a href="#feature-files" id="markdown-toc-feature-files">Feature files</a></li> <li><a href="#input-format" id="markdown-toc-input-format">Input format</a></li> <li><a href="#mounts" id="markdown-toc-mounts">Mounts</a></li> </ol> </li> <li><a href="#custom-feature-source" id="markdown-toc-custom-feature-source">Custom feature source</a> <ol> <li><a href="#an-example-custom-feature-source-configuration" id="markdown-toc-an-example-custom-feature-source-configuration">An example custom feature source configuration</a></li> <li><a href="#additional-configuration-directory" id="markdown-toc-additional-configuration-directory">Additional configuration directory</a></li> </ol> </li> <li><a href="#node-labels" id="markdown-toc-node-labels">Node labels</a></li> <li><a href="#feature-rule-format" id="markdown-toc-feature-rule-format">Feature rule format</a> <ol> <li><a href="#fields" id="markdown-toc-fields">Fields</a></li> <li><a href="#available-features" id="markdown-toc-available-features">Available features</a></li> <li><a href="#templating" id="markdown-toc-templating">Templating</a></li> <li><a href="#backreferences" id="markdown-toc-backreferences">Backreferences</a></li> <li><a href="#examples" id="markdown-toc-examples">Examples</a></li> </ol> </li> </ol><hr /> <h2 id="overview"> <a href="#overview" class="anchor-heading" aria-labelledby="overview"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Overview </h2> <p>NFD provides multiple extension points for vendor and application specific labeling:</p> <ul> <li><a href="#nodefeature-custom-resource"><code class="language-plaintext highlighter-rouge">NodeFeature</code></a> objects can be used to communicate “raw” node features and node labeling requests to nfd-master.</li> <li><a href="#nodefeaturerule-custom-resource"><code class="language-plaintext highlighter-rouge">NodeFeatureRule</code></a> objects provide a way to deploy custom labeling rules via the Kubernetes API.</li> <li><a href="#local-feature-source"><code class="language-plaintext highlighter-rouge">local</code></a> feature source of nfd-worker creates labels by reading text files.</li> <li><a href="#custom-feature-source"><code class="language-plaintext highlighter-rouge">custom</code></a> feature source of nfd-worker creates labels based on user-specified rules.</li> </ul> <h2 id="nodefeature-custom-resource"> <a href="#nodefeature-custom-resource" class="anchor-heading" aria-labelledby="nodefeature-custom-resource"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> NodeFeature custom resource </h2> <p>NodeFeature objects provide a way for 3rd party extensions to advertise custom features, both as “raw” features that serve as input to <a href="#nodefeaturerule-custom-resource">NodeFeatureRule</a> objects and as feature labels directly.</p> <p>Note that RBAC rules must be created for each extension for them to be able to create and manipulate NodeFeature objects in their namespace.</p> <h3 id="a-nodefeature-example"> <a href="#a-nodefeature-example" class="anchor-heading" aria-labelledby="a-nodefeature-example"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> A NodeFeature example </h3> <p>Consider the following referential example:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">nfd.k8s-sigs.io/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">NodeFeature</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">nfd.node.kubernetes.io/node-name</span><span class="pi">:</span> <span class="s">node-1</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">vendor-features-for-node-1</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="c1"># Features for NodeFeatureRule matching</span>
  <span class="na">features</span><span class="pi">:</span>
    <span class="na">flags</span><span class="pi">:</span>
      <span class="na">vendor.flags</span><span class="pi">:</span>
        <span class="na">elements</span><span class="pi">:</span>
          <span class="na">feature-x</span><span class="pi">:</span> <span class="pi">{}</span>
          <span class="na">feature-y</span><span class="pi">:</span> <span class="pi">{}</span>
    <span class="na">attributes</span><span class="pi">:</span>
      <span class="na">vendor.config</span><span class="pi">:</span>
        <span class="na">elements</span><span class="pi">:</span>
          <span class="na">setting-a</span><span class="pi">:</span> <span class="s2">"</span><span class="s">auto"</span>
          <span class="na">knob-b</span><span class="pi">:</span> <span class="s2">"</span><span class="s">123"</span>
    <span class="na">instances</span><span class="pi">:</span>
      <span class="na">vendor.devices</span><span class="pi">:</span>
        <span class="na">elements</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">attributes</span><span class="pi">:</span>
            <span class="na">model</span><span class="pi">:</span> <span class="s2">"</span><span class="s">dev-1000"</span>
            <span class="na">vendor</span><span class="pi">:</span> <span class="s2">"</span><span class="s">acme"</span>
        <span class="pi">-</span> <span class="na">attributes</span><span class="pi">:</span>
            <span class="na">model</span><span class="pi">:</span> <span class="s2">"</span><span class="s">dev-2000"</span>
            <span class="na">vendor</span><span class="pi">:</span> <span class="s2">"</span><span class="s">acme"</span>
  <span class="c1"># Labels to be created</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">vendor.io/feature.enabled</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
</code></pre></div></div> <p>The object targets node named <code class="language-plaintext highlighter-rouge">node-1</code>. It lists two “flag type” features under the <code class="language-plaintext highlighter-rouge">vendor.flags</code> domain, two “attribute type” features and under the <code class="language-plaintext highlighter-rouge">vendor.config</code> domain and two “instance type” features under the <code class="language-plaintext highlighter-rouge">vendor.devices</code> domain. These features will not be directly affecting the node labels but they will be used as input when the <a href="#nodefeaturerule-custom-resource"><code class="language-plaintext highlighter-rouge">NodeFeatureRule</code></a> objects are evaluated.</p> <p>In addition, the example requests directly the <code class="language-plaintext highlighter-rouge">vendor.io/feature.enabled=true</code> node label to be created.</p> <p>The <code class="language-plaintext highlighter-rouge">nfd.node.kubernetes.io/node-name=&lt;node-name&gt;</code> must be in place for each NodeFeature object as NFD uses it to determine the node which it is targeting.</p> <h3 id="feature-types"> <a href="#feature-types" class="anchor-heading" aria-labelledby="feature-types"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Feature types </h3> <p>Features have three different types:</p> <ul> <li><strong>flag</strong> features: a set of names without any associated values, e.g. CPUID flags or loaded kernel modules</li> <li><strong>attribute</strong> features: a set of names each of which has a single value associated with it (essentially a map of key-value pairs), e.g. kernel config flags or os release information</li> <li><strong>instance</strong> features: a list of instances, each of which has multiple attributes (key-value pairs of their own) associated with it, e.g. PCI or USB devices</li> </ul> <h2 id="nodefeaturerule-custom-resource"> <a href="#nodefeaturerule-custom-resource" class="anchor-heading" aria-labelledby="nodefeaturerule-custom-resource"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> NodeFeatureRule custom resource </h2> <p><code class="language-plaintext highlighter-rouge">NodeFeatureRule</code> objects provide an easy way to create vendor or application specific labels and taints. It uses a flexible rule-based mechanism for creating labels and optionally taints based on node features.</p> <h3 id="a-nodefeaturerule-example"> <a href="#a-nodefeaturerule-example" class="anchor-heading" aria-labelledby="a-nodefeaturerule-example"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> A NodeFeatureRule example </h3> <p>Consider the following referential example:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">nfd.k8s-sigs.io/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">NodeFeatureRule</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">my-sample-rule-object</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">rules</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">my</span><span class="nv"> </span><span class="s">sample</span><span class="nv"> </span><span class="s">rule"</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="s2">"</span><span class="s">feature.node.kubernetes.io/my-sample-feature"</span><span class="err">:</span> <span class="s2">"</span><span class="s">true"</span>
      <span class="na">matchFeatures</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">feature</span><span class="pi">:</span> <span class="s">kernel.loadedmodule</span>
          <span class="na">matchExpressions</span><span class="pi">:</span>
            <span class="na">dummy</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">op</span><span class="pi">:</span> <span class="nv">Exists</span><span class="pi">}</span>
        <span class="pi">-</span> <span class="na">feature</span><span class="pi">:</span> <span class="s">kernel.config</span>
          <span class="na">matchExpressions</span><span class="pi">:</span>
            <span class="na">X86</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">op</span><span class="pi">:</span> <span class="nv">In</span><span class="pi">,</span> <span class="nv">value</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">y"</span><span class="pi">]}</span>
</code></pre></div></div> <p>It specifies one rule which creates node label <code class="language-plaintext highlighter-rouge">feature.node.kubernetes.io/my-sample-feature=true</code> if both of the following conditions are true (<code class="language-plaintext highlighter-rouge">matchFeatures</code> implements a logical AND over the matchers):</p> <ul> <li>The <code class="language-plaintext highlighter-rouge">dummy</code> network driver module has been loaded</li> <li>X86 option in kernel config is set to <code class="language-plaintext highlighter-rouge">=y</code></li> </ul> <p>Create a <code class="language-plaintext highlighter-rouge">NodeFeatureRule</code> with a yaml file:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl apply <span class="nt">-f</span> https://raw.githubusercontent.com/kubernetes-sigs/node-feature-discovery/master/examples/nodefeaturerule.yaml
</code></pre></div></div> <p>Now, on X86 platforms the feature label appears after doing <code class="language-plaintext highlighter-rouge">modprobe dummy</code> on a system and correspondingly the label is removed after <code class="language-plaintext highlighter-rouge">rmmod dummy</code>. Note a re-labeling delay up to the sleep-interval of nfd-worker (1 minute by default).</p> <p>See <a href="#feature-rule-format">Feature rule format</a> for detailed description of available fields and how to write labeling rules.</p> <h3 id="node-tainting"> <a href="#node-tainting" class="anchor-heading" aria-labelledby="node-tainting"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Node tainting </h3> <p>In some circumstances, it is desirable to keep nodes with specialized hardware away from running general workload and instead leave them for workloads that need the specialized hardware. One way to achieve it is to taint the nodes with the specialized hardware and add corresponding toleration to pods that require the special hardware. NFD offers node tainting functionality which is disabled by default. User can define one or more custom taints via the <code class="language-plaintext highlighter-rouge">taints</code> field of the NodeFeatureRule CR. The same rule-based mechanism is applied here and the NFD taints only rule matching nodes.</p> <p>To enable the tainting feature, <code class="language-plaintext highlighter-rouge">--enable-taints</code> flag needs to be set to <code class="language-plaintext highlighter-rouge">true</code>. If the flag <code class="language-plaintext highlighter-rouge">--enable-taints</code> is set to <code class="language-plaintext highlighter-rouge">false</code> (i.e. disabled), taints defined in the NodeFeatureRule CR have no effect and will be ignored by the NFD master.</p> <p>See documentation of the <a href="#taints">taints field</a> for detailed description how to specify taints in the NodeFeatureRule object.</p> <blockquote> <p><strong>NOTE:</strong> Before enabling any taints, make sure to edit nfd-worker daemonset to tolerate the taints to be created. Otherwise, already running pods that do not tolerate the taint are evicted immediately from the node including the nfd-worker pod.</p> </blockquote> <h2 id="nodefeaturegroup-custom-resource"> <a href="#nodefeaturegroup-custom-resource" class="anchor-heading" aria-labelledby="nodefeaturegroup-custom-resource"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> NodeFeatureGroup custom resource </h2> <p>NodeFeatureGroup API is an alpha feature and disabled by default in NFD version master. Use the <a href="/node-feature-discovery/master/reference/feature-gates.html#nodefeaturegroupapi">NodeFeatureAPI</a> feature gate to enable it.</p> <p><code class="language-plaintext highlighter-rouge">NodeFeatureGroup</code> objects provide a way to create node groups that share the same set of features. The <code class="language-plaintext highlighter-rouge">NodeFeatureGroup</code> object spec consists of a list of <code class="language-plaintext highlighter-rouge">NodeFeatureRule</code> that follow the same format as the <code class="language-plaintext highlighter-rouge">NodeFeatureRule</code>, but the difference in this case is that nodes that match any of the rules in the <code class="language-plaintext highlighter-rouge">NodeFeatureGroup</code> will be listed in the <code class="language-plaintext highlighter-rouge">NodeFeatureGroup</code> status.</p> <h3 id="a-nodefeaturegroup-example"> <a href="#a-nodefeaturegroup-example" class="anchor-heading" aria-labelledby="a-nodefeaturegroup-example"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> A NodeFeatureGroup example </h3> <p>Consider the following referential example:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">nfd.k8s-sigs.io/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">NodeFeatureGroup</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">node-feature-group-example</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">featureGroupRules</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">kernel</span><span class="nv"> </span><span class="s">version"</span>
      <span class="na">matchFeatures</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">feature</span><span class="pi">:</span> <span class="s">kernel.version</span>
          <span class="na">matchExpressions</span><span class="pi">:</span>
            <span class="na">major</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">op</span><span class="pi">:</span> <span class="nv">In</span><span class="pi">,</span> <span class="nv">value</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">6"</span><span class="pi">]}</span>
<span class="na">status</span><span class="pi">:</span>
  <span class="na">nodes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">node-1</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">node-2</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">node-3</span>
</code></pre></div></div> <p>The object specifies a group of nodes that share the same <code class="language-plaintext highlighter-rouge">kernel.version.major</code> (Linux kernel v6.x).</p> <p>Create a <code class="language-plaintext highlighter-rouge">NodeFeatureGroup</code> with a yaml file:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl apply <span class="nt">-f</span> https://raw.githubusercontent.com/kubernetes-sigs/node-feature-discovery/master/examples/nodefeaturegroup.yaml
</code></pre></div></div> <p>See <a href="#feature-rule-format">Feature rule format</a> for detailed description of available fields and how to write group filtering rules.</p> <h2 id="local-feature-source"> <a href="#local-feature-source" class="anchor-heading" aria-labelledby="local-feature-source"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Local feature source </h2> <p>NFD-Worker has a special feature source named <code class="language-plaintext highlighter-rouge">local</code> which is an integration point for external feature detectors. It provides a mechanism for pluggable extensions, allowing the creation of new user-specific features and even overriding built-in labels.</p> <p>The <code class="language-plaintext highlighter-rouge">local</code> feature source uses feature files. The features discovered by the <code class="language-plaintext highlighter-rouge">local</code> source can further be used in label rules specified in <a href="#nodefeaturerule-custom-resource"><code class="language-plaintext highlighter-rouge">NodeFeatureRule</code></a> objects and the <a href="#custom-feature-source"><code class="language-plaintext highlighter-rouge">custom</code></a> feature source.</p> <blockquote> <p><strong>NOTE:</strong> Be careful when creating and/or updating feature files while NFD is running. To avoid race conditions you should write into a temporary file, and atomically create/update the original file by doing a file rename operation. NFD ignores dot files, so temporary file can be written to the same directory and renamed (<code class="language-plaintext highlighter-rouge">.my.feature</code> -&gt; <code class="language-plaintext highlighter-rouge">my.feature</code>) once file is complete. Both file names should (obviously) be unique for the given application.</p> </blockquote> <h3 id="an-example"> <a href="#an-example" class="anchor-heading" aria-labelledby="an-example"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> An example </h3> <p>Consider a plaintext file <code class="language-plaintext highlighter-rouge">/etc/kubernetes/node-feature-discovery/features.d/my-features</code> having the following contents:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>feature.node.kubernetes.io/my-feature.1
feature.node.kubernetes.io/my-feature.2=myvalue
vendor.io/my-feature.3=456
</code></pre></div></div> <p>This will translate into the following node labels:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">feature.node.kubernetes.io/my-feature.1</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
<span class="na">feature.node.kubernetes.io/my-feature.2</span><span class="pi">:</span> <span class="s2">"</span><span class="s">myvalue"</span>
<span class="na">vendor.io/my-feature.3</span><span class="pi">:</span> <span class="s2">"</span><span class="s">456"</span>
</code></pre></div></div> <h3 id="feature-files"> <a href="#feature-files" class="anchor-heading" aria-labelledby="feature-files"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Feature files </h3> <p>The <code class="language-plaintext highlighter-rouge">local</code> source reads files found in <code class="language-plaintext highlighter-rouge">/etc/kubernetes/node-feature-discovery/features.d/</code>. File content is parsed and translated into node labels, see the <a href="#input-format">input format below</a>.</p> <h3 id="input-format"> <a href="#input-format" class="anchor-heading" aria-labelledby="input-format"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Input format </h3> <p>The feature files are expected to contain features in simple key-value pairs, separated by newlines:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># This is a comment
&lt;key&gt;[=&lt;value&gt;]
</code></pre></div></div> <p>The label value defaults to <code class="language-plaintext highlighter-rouge">true</code>, if not specified.</p> <p>Label namespace must be specified with <code class="language-plaintext highlighter-rouge">&lt;namespace&gt;/&lt;name&gt;[=&lt;value&gt;]</code>.</p> <blockquote> <p><strong>NOTE:</strong> The feature file size limit it 64kB. The feature file will be ignored if the size limit is exceeded.</p> </blockquote> <p>Comment lines (starting with <code class="language-plaintext highlighter-rouge">#</code>) are ignored.</p> <p>Adding following line anywhere to feature file defines date when its content expires / is ignored:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># +expiry-time=2023-07-29T11:22:33Z
</code></pre></div></div> <p>Also, the expiry-time value would stay the same during the processing of the feature file until another expiry-time directive is encountered. Considering the following file:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># +expiry-time=2012-07-28T11:22:33Z
vendor.io/feature1=featureValue

# +expiry-time=2080-07-28T11:22:33Z
vendor.io/feature2=featureValue2

# +expiry-time=2070-07-28T11:22:33Z
vendor.io/feature3=featureValue3

# +expiry-time=2002-07-28T11:22:33Z
vendor.io/feature4=featureValue4
</code></pre></div></div> <p>After processing the above file, only <code class="language-plaintext highlighter-rouge">vendor.io/feature2</code> and <code class="language-plaintext highlighter-rouge">vendor.io/feature3</code> would be included in the list of accepted features.</p> <blockquote> <p><strong>NOTE:</strong> The time format supported is RFC3339. Also, the <code class="language-plaintext highlighter-rouge">expiry-time</code> tag is only evaluated in each re-discovery period, and the expiration of node labels is not tracked.</p> </blockquote> <p>To exclude specific features from the <code class="language-plaintext highlighter-rouge">local.feature</code> Feature, you can use the <code class="language-plaintext highlighter-rouge"># +no-feature</code> directive. The <code class="language-plaintext highlighter-rouge"># +no-label</code> directive causes the feature to be excluded from the <code class="language-plaintext highlighter-rouge">local.label</code> Feature and a node label not to be generated.</p> <p>Considering the following file:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># +no-feature
vendor.io/label-only=value

vendor.io/my-feature=value

vendor.io/foo=bar

# +no-label
foo=baz
</code></pre></div></div> <p>Processing the above file would result in the following Features:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">local.features</span><span class="pi">:</span>
  <span class="na">foo</span><span class="pi">:</span> <span class="s">baz</span>
  <span class="na">vendor.io/my-feature</span><span class="pi">:</span> <span class="s">value</span>
<span class="na">local.labels</span><span class="pi">:</span>
  <span class="na">vendor.io/label-only</span><span class="pi">:</span> <span class="s">value</span>
  <span class="na">vendor.io/my-feature</span><span class="pi">:</span> <span class="s">value</span>
</code></pre></div></div> <p>and the following labels added to the Node:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vendor.io/label-only=value
vendor.io/my-feature=value
</code></pre></div></div> <blockquote> <p><strong>NOTE:</strong> use of unprefixed label names (like <code class="language-plaintext highlighter-rouge">foo=bar</code>) should not be used. In NFD master unprefixed names will be automatically prefixed with <code class="language-plaintext highlighter-rouge">feature.node.kubernetes.io/</code> but this will change in a future version (see the <a href="/node-feature-discovery/master/reference/feature-gates.html#disableautoprefix">DisableAutoPrefix</a> feature gate). Unprefixed names for plain Features (tagged with <code class="language-plaintext highlighter-rouge">#+no-label</code>) can be used without restrictions, however.</p> </blockquote> <h3 id="mounts"> <a href="#mounts" class="anchor-heading" aria-labelledby="mounts"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Mounts </h3> <p>The standard NFD deployments contain <code class="language-plaintext highlighter-rouge">hostPath</code> mounts for <code class="language-plaintext highlighter-rouge">/etc/kubernetes/node-feature-discovery/features.d/</code>, making these directories from the host available inside the nfd-worker container.</p> <h4 id="injecting-labels-from-other-pods"> <a href="#injecting-labels-from-other-pods" class="anchor-heading" aria-labelledby="injecting-labels-from-other-pods"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Injecting labels from other pods </h4> <p>One use case for the feature files is detecting features in other Pods outside NFD, e.g. in Kubernetes device plugins. By using the same <code class="language-plaintext highlighter-rouge">hostPath</code> mounts <code class="language-plaintext highlighter-rouge">/etc/kubernetes/node-feature-discovery/features.d/</code> in the side-car (e.g. device plugin) creates a shared area for deploying feature files to NFD.</p> <h2 id="custom-feature-source"> <a href="#custom-feature-source" class="anchor-heading" aria-labelledby="custom-feature-source"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Custom feature source </h2> <p>The <code class="language-plaintext highlighter-rouge">custom</code> feature source in nfd-worker provides a rule-based mechanism for label creation, similar to the <a href="#nodefeaturerule-custom-resource"><code class="language-plaintext highlighter-rouge">NodeFeatureRule</code></a> objects. The difference is that the rules are specified in the worker configuration instead of a Kubernetes API object.</p> <p>See <a href="/node-feature-discovery/master/usage/nfd-worker.html#worker-configuration">worker configuration</a> for instructions how to set-up and manage the worker configuration.</p> <h3 id="an-example-custom-feature-source-configuration"> <a href="#an-example-custom-feature-source-configuration" class="anchor-heading" aria-labelledby="an-example-custom-feature-source-configuration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> An example custom feature source configuration </h3> <p>Consider the following referential configuration for nfd-worker:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">core</span><span class="pi">:</span>
  <span class="na">labelSources</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">custom"</span><span class="pi">]</span>
<span class="na">sources</span><span class="pi">:</span>
  <span class="na">custom</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">my</span><span class="nv"> </span><span class="s">sample</span><span class="nv"> </span><span class="s">rule"</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="s2">"</span><span class="s">feature.node.kubenernetes.io/my-sample-feature"</span><span class="err">:</span> <span class="s2">"</span><span class="s">true"</span>
      <span class="na">matchFeatures</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">feature</span><span class="pi">:</span> <span class="s">kernel.loadedmodule</span>
          <span class="na">matchExpressions</span><span class="pi">:</span>
            <span class="na">dummy</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">op</span><span class="pi">:</span> <span class="nv">Exists</span><span class="pi">}</span>
        <span class="pi">-</span> <span class="na">feature</span><span class="pi">:</span> <span class="s">kernel.config</span>
          <span class="na">matchExpressions</span><span class="pi">:</span>
            <span class="na">X86</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">op</span><span class="pi">:</span> <span class="nv">In</span><span class="pi">,</span> <span class="nv">value</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">y"</span><span class="pi">]}</span>
</code></pre></div></div> <p>It specifies one rule which creates node label <code class="language-plaintext highlighter-rouge">feature.node.kubenernetes.io/my-sample-feature=true</code> if both of the following conditions are true (<code class="language-plaintext highlighter-rouge">matchFeatures</code> implements a logical AND over the matchers):</p> <ul> <li>The <code class="language-plaintext highlighter-rouge">dummy</code> network driver module has been loaded</li> <li>X86 option in kernel config is set to <code class="language-plaintext highlighter-rouge">=y</code></li> </ul> <p>In addition, the configuration only enables the <code class="language-plaintext highlighter-rouge">custom</code> source, disabling all built-in labels.</p> <p>Now, on X86 platforms the feature label appears after doing <code class="language-plaintext highlighter-rouge">modprobe dummy</code> on a system and correspondingly the label is removed after <code class="language-plaintext highlighter-rouge">rmmod dummy</code>. Note a re-labeling delay up to the sleep-interval of nfd-worker (1 minute by default).</p> <h3 id="additional-configuration-directory"> <a href="#additional-configuration-directory" class="anchor-heading" aria-labelledby="additional-configuration-directory"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Additional configuration directory </h3> <p>In addition to the rules defined in the nfd-worker configuration file, the <code class="language-plaintext highlighter-rouge">custom</code> feature source can read more configuration files located in the <code class="language-plaintext highlighter-rouge">/etc/kubernetes/node-feature-discovery/custom.d/</code> directory. This makes more dynamic and flexible configuration easier.</p> <p>As an example, consider having file <code class="language-plaintext highlighter-rouge">/etc/kubernetes/node-feature-discovery/custom.d/my-rule.yaml</code> with the following content:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">my</span><span class="nv"> </span><span class="s">e1000</span><span class="nv"> </span><span class="s">rule"</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="s2">"</span><span class="s">feature.node.kubenernetes.io/e1000.present"</span><span class="err">:</span> <span class="s2">"</span><span class="s">true"</span>
  <span class="na">matchFeatures</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">feature</span><span class="pi">:</span> <span class="s">kernel.loadedmodule</span>
      <span class="na">matchExpressions</span><span class="pi">:</span>
        <span class="na">e1000</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">op</span><span class="pi">:</span> <span class="nv">Exists</span><span class="pi">}</span>
</code></pre></div></div> <p>This simple rule will create <code class="language-plaintext highlighter-rouge">feature.node.kubenernetes.io/e1000.present=true</code> label if the <code class="language-plaintext highlighter-rouge">e1000</code> kernel module has been loaded.</p> <p>The <a href="https://github.com/kubernetes-sigs/node-feature-discovery/blob/master/deployment/overlays/samples/custom-rules"><code class="language-plaintext highlighter-rouge">samples/custom-rules</code></a> kustomize overlay sample contains an example for deploying a custom rule from a ConfigMap.</p> <h2 id="node-labels"> <a href="#node-labels" class="anchor-heading" aria-labelledby="node-labels"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Node labels </h2> <p>Feature labels have the following format:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;namespace&gt;/&lt;name&gt; = &lt;value&gt;
</code></pre></div></div> <p>The namespace part (i.e. prefix) of the labels is controlled by nfd:</p> <ul> <li>All built-in labels use <code class="language-plaintext highlighter-rouge">feature.node.kubernetes.io</code>.</li> <li>Namespaces may be excluded with the <a href="/node-feature-discovery/master/reference/master-commandline-reference.html#-deny-label-ns"><code class="language-plaintext highlighter-rouge">-deny-label-ns</code></a> command line flag of nfd-master <ul> <li>To allow specific namespaces that were denied, you can use <a href="/node-feature-discovery/master/reference/master-commandline-reference.html#-extra-label-ns"><code class="language-plaintext highlighter-rouge">-extra-label-ns</code></a> command line flag of nfd-master. e.g: <code class="language-plaintext highlighter-rouge">nfd-master -deny-label-ns="*" -extra-label-ns=example.com</code></li> </ul> </li> </ul> <h2 id="feature-rule-format"> <a href="#feature-rule-format" class="anchor-heading" aria-labelledby="feature-rule-format"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Feature rule format </h2> <p>This section describes the rule format used in <a href="#nodefeaturerule-custom-resource"><code class="language-plaintext highlighter-rouge">NodeFeatureRule</code></a> objects and in the configuration of the <a href="#custom-feature-source"><code class="language-plaintext highlighter-rouge">custom</code></a> feature source.</p> <p>It is based on a generic feature matcher that covers all features discovered by nfd-worker. The rules rely on a unified data model of the available features and a generic expression-based format. Features that can be used in the rules are described in detail in <a href="#available-features">available features</a> below.</p> <p>Take this rule as a referential example:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">my</span><span class="nv"> </span><span class="s">feature</span><span class="nv"> </span><span class="s">rule"</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="s2">"</span><span class="s">feature.node.kubernetes.io/my-special-feature"</span><span class="err">:</span> <span class="s2">"</span><span class="s">my-value"</span>
      <span class="na">matchFeatures</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">feature</span><span class="pi">:</span> <span class="s">cpu.cpuid</span>
          <span class="na">matchExpressions</span><span class="pi">:</span>
            <span class="na">AVX512F</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">op</span><span class="pi">:</span> <span class="nv">Exists</span><span class="pi">}</span>
        <span class="pi">-</span> <span class="na">feature</span><span class="pi">:</span> <span class="s">kernel.version</span>
          <span class="na">matchExpressions</span><span class="pi">:</span>
            <span class="na">major</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">op</span><span class="pi">:</span> <span class="nv">In</span><span class="pi">,</span> <span class="nv">value</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">5"</span><span class="pi">]}</span>
            <span class="na">minor</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">op</span><span class="pi">:</span> <span class="nv">Gt</span><span class="pi">,</span> <span class="nv">value</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">1"</span><span class="pi">]}</span>
        <span class="pi">-</span> <span class="na">feature</span><span class="pi">:</span> <span class="s">pci.device</span>
          <span class="na">matchExpressions</span><span class="pi">:</span>
            <span class="na">vendor</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">op</span><span class="pi">:</span> <span class="nv">In</span><span class="pi">,</span> <span class="nv">value</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">8086"</span><span class="pi">]}</span>
            <span class="na">class</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">op</span><span class="pi">:</span> <span class="nv">In</span><span class="pi">,</span> <span class="nv">value</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">0200"</span><span class="pi">]}</span>
</code></pre></div></div> <p>This will yield <code class="language-plaintext highlighter-rouge">feature.node.kubernetes.io/my-special-feature=my-value</code> node label if all of these are true (<code class="language-plaintext highlighter-rouge">matchFeatures</code> implements a logical AND over the matchers):</p> <ul> <li>the CPU has AVX512F capability</li> <li>kernel version is 5.2 or later (must be v5.x)</li> <li>an Intel network controller is present</li> </ul> <h3 id="fields"> <a href="#fields" class="anchor-heading" aria-labelledby="fields"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Fields </h3> <h4 id="name"> <a href="#name" class="anchor-heading" aria-labelledby="name"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> name </h4> <p>The <code class="language-plaintext highlighter-rouge">.name</code> field is required and used as an identifier of the rule.</p> <h4 id="labels"> <a href="#labels" class="anchor-heading" aria-labelledby="labels"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> labels </h4> <p>The <code class="language-plaintext highlighter-rouge">.labels</code> is a map of the node labels to create if the rule matches.</p> <p>Take this rule as a referential example:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">nfd.k8s-sigs.io/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">NodeFeatureRule</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">my-sample-rule-object</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">rules</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">my</span><span class="nv"> </span><span class="s">dynamic</span><span class="nv"> </span><span class="s">label</span><span class="nv"> </span><span class="s">value</span><span class="nv"> </span><span class="s">rule"</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">feature.node.kubernetes.io/linux-lsm-enabled</span><span class="pi">:</span> <span class="s2">"</span><span class="s">@kernel.config.LSM"</span>
        <span class="na">feature.node.kubernetes.io/custom-label</span><span class="pi">:</span> <span class="s2">"</span><span class="s">customlabel"</span>
</code></pre></div></div> <p>Label <code class="language-plaintext highlighter-rouge">linux-lsm-enabled</code> uses the <code class="language-plaintext highlighter-rouge">@</code> notation for dynamic values. The value of the label will be the value of the attribute <code class="language-plaintext highlighter-rouge">LSM</code> of the feature <code class="language-plaintext highlighter-rouge">kernel.config</code>.</p> <p>The <code class="language-plaintext highlighter-rouge">@&lt;feature-name&gt;.&lt;element-name&gt;</code> format can be used to inject values of detected features to the label. See <a href="#available-features">available features</a> for possible values to use.</p> <p>This will yield into the following node label:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="na">labels</span><span class="pi">:</span>
    <span class="s">...</span>
    <span class="s">feature.node.kubernetes.io/linux-lsm-enabled</span><span class="err">:</span> <span class="s">apparmor</span>
    <span class="s">feature.node.kubernetes.io/custom-label</span><span class="err">:</span> <span class="s2">"</span><span class="s">customlabel"</span>
</code></pre></div></div> <h4 id="labelstemplate"> <a href="#labelstemplate" class="anchor-heading" aria-labelledby="labelstemplate"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> labelsTemplate </h4> <p>The <code class="language-plaintext highlighter-rouge">.labelsTemplate</code> field specifies a text template for dynamically creating labels based on the matched features. See <a href="#templating">templating</a> for details.</p> <blockquote> <p><strong>NOTE:</strong> The <code class="language-plaintext highlighter-rouge">labels</code> field has priority over <code class="language-plaintext highlighter-rouge">labelsTemplate</code>, i.e. labels specified in the <code class="language-plaintext highlighter-rouge">labels</code> field will override anything originating from <code class="language-plaintext highlighter-rouge">labelsTemplate</code>.</p> </blockquote> <h4 id="annotations"> <a href="#annotations" class="anchor-heading" aria-labelledby="annotations"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> annotations </h4> <p>The <code class="language-plaintext highlighter-rouge">.annotations</code> field is a list of features to be advertised as node annotations.</p> <p>Take this rule as a referential example:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">nfd.k8s-sigs.io/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">NodeFeatureRule</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">feature-annotations-example</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">rules</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">annotation-example"</span>
      <span class="na">annotations</span><span class="pi">:</span>
        <span class="na">feature.node.kubernetes.io/defaul-ns-annotation</span><span class="pi">:</span> <span class="s2">"</span><span class="s">foo"</span>
        <span class="na">custom.vendor.io/feature</span><span class="pi">:</span> <span class="s2">"</span><span class="s">baz"</span>
      <span class="na">matchFeatures</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">feature</span><span class="pi">:</span> <span class="s">kernel.version</span>
          <span class="na">matchExpressions</span><span class="pi">:</span>
            <span class="na">major</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">op</span><span class="pi">:</span> <span class="nv">Exists</span><span class="pi">}</span>
</code></pre></div></div> <p>This will yield into the following node annotations:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="na">annotations</span><span class="pi">:</span>
    <span class="s">...</span>
    <span class="s">feature.node.kubernetes.io/defaul-ns-annotation</span><span class="err">:</span> <span class="s2">"</span><span class="s">foo"</span>
    <span class="na">custom.vendor.io/feature</span><span class="pi">:</span> <span class="s2">"</span><span class="s">baz"</span>
    <span class="s">...</span>
</code></pre></div></div> <p>NFD enforces some limitations to the namespace (or prefix)/ of the annotations:</p> <ul> <li><code class="language-plaintext highlighter-rouge">kubernetes.io/</code> and its sub-namespaces (like <code class="language-plaintext highlighter-rouge">sub.ns.kubernetes.io/</code>) cannot generally be used</li> <li>the only exception is <code class="language-plaintext highlighter-rouge">feature.node.kubernetes.io/</code> and its sub-namespaces (like <code class="language-plaintext highlighter-rouge">sub.ns.feature.node.kubernetes.io</code>)</li> <li>unprefixed names (like <code class="language-plaintext highlighter-rouge">my-annotation</code>) should not be used. In NFD master unprefixed names will be automatically prefixed with <code class="language-plaintext highlighter-rouge">feature.node.kubernetes.io/</code> but this will change in a future version (see the <a href="/node-feature-discovery/master/reference/feature-gates.html#disableautoprefix">DisableAutoPrefix</a> feature gate).</li> </ul> <blockquote> <p><strong>NOTE:</strong> The <code class="language-plaintext highlighter-rouge">annotations</code> field has will only advertise features via node annotations the features won’t be advertised as node labels unless they are specified in the <code class="language-plaintext highlighter-rouge">labels</code> field.</p> </blockquote> <h4 id="taints"> <a href="#taints" class="anchor-heading" aria-labelledby="taints"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> taints </h4> <p><em>taints</em> is a list of taint entries and each entry can have <code class="language-plaintext highlighter-rouge">key</code>, <code class="language-plaintext highlighter-rouge">value</code> and <code class="language-plaintext highlighter-rouge">effect</code>, where the <code class="language-plaintext highlighter-rouge">value</code> is optional. Effect could be <code class="language-plaintext highlighter-rouge">NoSchedule</code>, <code class="language-plaintext highlighter-rouge">PreferNoSchedule</code> or <code class="language-plaintext highlighter-rouge">NoExecute</code>. To learn more about the meaning of these effects, check out k8s <a href="https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/">documentation</a>.</p> <p>Example NodeFeatureRule with taints:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">nfd.k8s-sigs.io/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">NodeFeatureRule</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">my-sample-rule-object</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">rules</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">my</span><span class="nv"> </span><span class="s">sample</span><span class="nv"> </span><span class="s">taint</span><span class="nv"> </span><span class="s">rule"</span>
      <span class="na">taints</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">effect</span><span class="pi">:</span> <span class="s">PreferNoSchedule</span>
          <span class="na">key</span><span class="pi">:</span> <span class="s2">"</span><span class="s">feature.node.kubernetes.io/special-node"</span>
          <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
        <span class="pi">-</span> <span class="na">effect</span><span class="pi">:</span> <span class="s">NoExecute</span>
          <span class="na">key</span><span class="pi">:</span> <span class="s2">"</span><span class="s">feature.node.kubernetes.io/dedicated-node"</span>
      <span class="na">matchFeatures</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">feature</span><span class="pi">:</span> <span class="s">kernel.loadedmodule</span>
          <span class="na">matchExpressions</span><span class="pi">:</span>
            <span class="na">dummy</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">op</span><span class="pi">:</span> <span class="nv">Exists</span><span class="pi">}</span>
        <span class="pi">-</span> <span class="na">feature</span><span class="pi">:</span> <span class="s">kernel.config</span>
          <span class="na">matchExpressions</span><span class="pi">:</span>
            <span class="na">X86</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">op</span><span class="pi">:</span> <span class="nv">In</span><span class="pi">,</span> <span class="nv">value</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">y"</span><span class="pi">]}</span>
</code></pre></div></div> <p>In this example, if the <code class="language-plaintext highlighter-rouge">my sample taint rule</code> rule is matched, <code class="language-plaintext highlighter-rouge">feature.node.kubernetes.io/pci-0300_1d0f.present=true:NoExecute</code> and <code class="language-plaintext highlighter-rouge">feature.node.kubernetes.io/cpu-cpuid.ADX:NoExecute</code> taints are set on the node.</p> <p>There are some limitations to the namespace part (i.e. prefix/) of the taint key:</p> <ul> <li><code class="language-plaintext highlighter-rouge">kubernetes.io/</code> and its sub-namespaces (like <code class="language-plaintext highlighter-rouge">sub.ns.kubernetes.io/</code>) cannot generally be used</li> <li>the only exception is <code class="language-plaintext highlighter-rouge">feature.node.kubernetes.io/</code> and its sub-namespaces (like <code class="language-plaintext highlighter-rouge">sub.ns.feature.node.kubernetes.io</code>)</li> <li>unprefixed keys (like <code class="language-plaintext highlighter-rouge">foo</code>) keys are disallowed</li> </ul> <blockquote> <p><strong>NOTE:</strong> taints field is not available for the custom rules of nfd-worker and only for NodeFeatureRule objects.</p> </blockquote> <h4 id="vars"> <a href="#vars" class="anchor-heading" aria-labelledby="vars"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> vars </h4> <p>The <code class="language-plaintext highlighter-rouge">.vars</code> field is a map of values (key-value pairs) to store for subsequent rules to use. In other words, these are variables that are not advertised as node labels. See <a href="#backreferences">backreferences</a> for more details on the usage of vars.</p> <h4 id="extendedresources"> <a href="#extendedresources" class="anchor-heading" aria-labelledby="extendedresources"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> extendedResources </h4> <p>The <code class="language-plaintext highlighter-rouge">.extendedResources</code> field is a list of extended resources to advertise. See <a href="#extended-resources">extended resources</a> for more details.</p> <p>Take this rule as a referential example:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">nfd.k8s-sigs.io/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">NodeFeatureRule</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">my-extended-resource-rule</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">rules</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">my</span><span class="nv"> </span><span class="s">extended</span><span class="nv"> </span><span class="s">resource</span><span class="nv"> </span><span class="s">rule"</span>
      <span class="na">extendedResources</span><span class="pi">:</span>
        <span class="na">vendor.io/dynamic</span><span class="pi">:</span> <span class="s2">"</span><span class="s">@kernel.version.major"</span>
        <span class="na">vendor.io/static</span><span class="pi">:</span> <span class="s2">"</span><span class="s">123"</span>
      <span class="na">matchFeatures</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">feature</span><span class="pi">:</span> <span class="s">kernel.version</span>
          <span class="na">matchExpressions</span><span class="pi">:</span>
            <span class="na">major</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">op</span><span class="pi">:</span> <span class="nv">Exists</span><span class="pi">}</span>
</code></pre></div></div> <p>The extended resource <code class="language-plaintext highlighter-rouge">vendor.io/dynamic</code> is defined in the form <code class="language-plaintext highlighter-rouge">@feature.attribute</code>. The value of the extended resource will be the value of the attribute <code class="language-plaintext highlighter-rouge">major</code> of the feature <code class="language-plaintext highlighter-rouge">kernel.version</code>.</p> <p>The <code class="language-plaintext highlighter-rouge">@&lt;feature-name&gt;.&lt;element-name&gt;</code> format can be used to inject values of detected features to the extended resource. See <a href="#available-features">available features</a> for possible values to use. Note that the value must be eligible as a Kubernetes resource quantity.</p> <p>This will yield into the following node status:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="na">allocatable</span><span class="pi">:</span>
    <span class="s">...</span>
    <span class="s">vendor.io/dynamic</span><span class="err">:</span> <span class="s2">"</span><span class="s">5"</span>
    <span class="na">vendor.io/static</span><span class="pi">:</span> <span class="s2">"</span><span class="s">123"</span>
    <span class="s">...</span>
  <span class="na">capacity</span><span class="pi">:</span>
    <span class="s">...</span>
    <span class="s">vendor.io/dynamic</span><span class="err">:</span> <span class="s2">"</span><span class="s">5"</span>
    <span class="na">vendor.io/static</span><span class="pi">:</span> <span class="s2">"</span><span class="s">123"</span>
    <span class="s">...</span>
</code></pre></div></div> <p>There are some limitations to the namespace part (i.e. prefix)/ of the Extended Resources names:</p> <ul> <li><code class="language-plaintext highlighter-rouge">kubernetes.io/</code> and its sub-namespaces (like <code class="language-plaintext highlighter-rouge">sub.ns.kubernetes.io/</code>) cannot generally be used</li> <li>the only exception is <code class="language-plaintext highlighter-rouge">feature.node.kubernetes.io/</code> and its sub-namespaces (like <code class="language-plaintext highlighter-rouge">sub.ns.feature.node.kubernetes.io</code>)</li> <li>unprefixed names (like <code class="language-plaintext highlighter-rouge">my-er</code>) site.version }} unprefixed names will be automatically prefixed with <code class="language-plaintext highlighter-rouge">feature.node.kubernetes.io/</code> but this will change in a future version (see the <a href="/node-feature-discovery/master/reference/feature-gates.html#disableautoprefix">DisableAutoPrefix</a> feature gate).</li> </ul> <blockquote> <p><strong>NOTE:</strong> <code class="language-plaintext highlighter-rouge">.extendedResources</code> is not supported by the <a href="#custom-feature-source">custom feature source</a> – it can only be used in NodeFeatureRule objects.</p> </blockquote> <h4 id="varstemplate"> <a href="#varstemplate" class="anchor-heading" aria-labelledby="varstemplate"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> varsTemplate </h4> <p>The <code class="language-plaintext highlighter-rouge">.varsTemplate</code> field specifies a text template for dynamically creating vars based on the matched features. See <a href="#templating">templating</a> for details on using templates and <a href="#backreferences">backreferences</a> for more details on the usage of vars.</p> <blockquote> <p><strong>NOTE:</strong> The <code class="language-plaintext highlighter-rouge">vars</code> field has priority over <code class="language-plaintext highlighter-rouge">varsTemplate</code>, i.e. vars specified in the <code class="language-plaintext highlighter-rouge">vars</code> field will override anything originating from <code class="language-plaintext highlighter-rouge">varsTemplate</code>.</p> </blockquote> <h4 id="matchfeatures"> <a href="#matchfeatures" class="anchor-heading" aria-labelledby="matchfeatures"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> matchFeatures </h4> <p>The <code class="language-plaintext highlighter-rouge">.matchFeatures</code> field specifies a feature matcher, consisting of a list of feature matcher terms. It implements a logical AND over the terms i.e. all of them must match for the rule to trigger.</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      <span class="na">matchFeatures</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">feature</span><span class="pi">:</span> <span class="s">&lt;feature-name&gt;</span>
          <span class="na">matchExpressions</span><span class="pi">:</span>
            <span class="na">&lt;key&gt;</span><span class="pi">:</span>
              <span class="na">op</span><span class="pi">:</span> <span class="s">&lt;op&gt;</span>
              <span class="na">value</span><span class="pi">:</span>
                <span class="pi">-</span> <span class="s">&lt;value-1&gt;</span>
                <span class="pi">-</span> <span class="s">...</span>
          <span class="na">matchName</span><span class="pi">:</span>
            <span class="na">op</span><span class="pi">:</span> <span class="s">&lt;op&gt;</span>
            <span class="na">value</span><span class="pi">:</span>
                <span class="pi">-</span> <span class="s">&lt;value-1&gt;</span>
                <span class="pi">-</span> <span class="s">...</span>
</code></pre></div></div> <p>The <code class="language-plaintext highlighter-rouge">.matchFeatures[].feature</code> field specifies the feature which to evaluate.</p> <blockquote> <p><strong>NOTE:</strong>If both <a href="#matchexpressions"><code class="language-plaintext highlighter-rouge">matchExpressions</code></a> and <a href="#matchname"><code class="language-plaintext highlighter-rouge">matchName</code></a> are specified, they both must match.</p> </blockquote> <h5 id="matchexpressions"> <a href="#matchexpressions" class="anchor-heading" aria-labelledby="matchexpressions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> matchExpressions </h5> <p>The <code class="language-plaintext highlighter-rouge">.matchFeatures[].matchExpressions</code> field is used to match against the value(s) of a feature. The <code class="language-plaintext highlighter-rouge">matchExpressions</code> field consists of a set of expressions, each of which is evaluated against all elements of the specified feature.</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      <span class="na">matchExpressions</span><span class="pi">:</span>
        <span class="na">&lt;key&gt;</span><span class="pi">:</span>
          <span class="na">op</span><span class="pi">:</span> <span class="s">&lt;op&gt;</span>
          <span class="na">value</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">&lt;value-1&gt;</span>
            <span class="pi">-</span> <span class="s">...</span>
          <span class="na">type</span><span class="pi">:</span> <span class="s">&lt;type&gt;</span>
</code></pre></div></div> <p>In each MatchExpression the <code class="language-plaintext highlighter-rouge">key</code> specifies the name of of the feature element (<em>flag</em> and <em>attribute</em> features) or name of the attribute (<em>instance</em> features) which to look for. The behavior of MatchExpression depends on the <a href="#feature-types">feature type</a>:</p> <ul> <li>for <em>flag</em> and <em>attribute</em> features the MatchExpression operates on the feature element whose name matches the <code class="language-plaintext highlighter-rouge">&lt;key&gt;</code></li> <li>for <em>instance</em> features all MatchExpressions are evaluated against the attributes of each instance separately</li> </ul> <p>The <code class="language-plaintext highlighter-rouge">op</code> field specifies the operator to apply. Valid values are described below.</p> <div class="table-wrapper"><table> <thead> <tr> <th>Operator</th> <th>Number of values</th> <th>Matches when</th> </tr> </thead> <tbody> <tr> <td><code class="language-plaintext highlighter-rouge">In</code></td> <td>1 or greater</td> <td>Input is equal to one of the values</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">NotIn</code></td> <td>1 or greater</td> <td>Input is not equal to any of the values</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">InRegexp</code></td> <td>1 or greater</td> <td>Values of the MatchExpression are treated as regexps and input matches one or more of them</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">Exists</code></td> <td>0</td> <td>The key exists</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">DoesNotExist</code></td> <td>0</td> <td>The key does not exists</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">Gt</code></td> <td>1</td> <td>Input is greater than the value. Both the input and value must be integer numbers.</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">Ge</code></td> <td>1</td> <td>Input is greater than or equal to the value. Both the input and value must be integer numbers.</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">Lt</code></td> <td>1</td> <td>Input is less than the value. Both the input and value must be integer numbers.</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">Le</code></td> <td>1</td> <td>Input is less than or equal to the value. Both the input and value must be integer numbers.</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">GtLt</code></td> <td>2</td> <td>Input is between two values. Both the input and value must be integer numbers.</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">GeLe</code></td> <td>2</td> <td>Input falls within a range that includes the boundary values. Both the input and value must be integer numbers.</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">IsTrue</code></td> <td>0</td> <td>Input is equal to “true”</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">IsFalse</code></td> <td>0</td> <td>Input is equal “false”</td> </tr> </tbody> </table></div> <p>The <code class="language-plaintext highlighter-rouge">value</code> field of MatchExpression is a list of string arguments to the operator.</p> <p>Type optional <code class="language-plaintext highlighter-rouge">type</code> field specifies the type of the <code class="language-plaintext highlighter-rouge">value</code> field. Valid types for specific operators are described below.</p> <div class="table-wrapper"><table> <thead> <tr> <th>Type</th> <th>Description</th> <th>Supported Operators</th> </tr> </thead> <tbody> <tr> <td><code class="language-plaintext highlighter-rouge">version</code></td> <td>Input is recognized as a version in the following formats (major.minor.patch) <code class="language-plaintext highlighter-rouge">%d.%d.%d</code>, <code class="language-plaintext highlighter-rouge">%d.%d</code>, <code class="language-plaintext highlighter-rouge">%d</code> (e.g., “1.2.3”, “1.2”, “1”)</td> <td><code class="language-plaintext highlighter-rouge">Gt</code>,<code class="language-plaintext highlighter-rouge">Ge</code>,<code class="language-plaintext highlighter-rouge">Lt</code>,<code class="language-plaintext highlighter-rouge">Le</code>,<code class="language-plaintext highlighter-rouge">GtLt</code>,<code class="language-plaintext highlighter-rouge">GeLe</code></td> </tr> </tbody> </table></div> <h5 id="matchname"> <a href="#matchname" class="anchor-heading" aria-labelledby="matchname"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> matchName </h5> <p>The <code class="language-plaintext highlighter-rouge">.matchFeatures[].matchName</code> field is used to match against the name(s) of a feature (whereas the <a href="#matchexpressions"><code class="language-plaintext highlighter-rouge">matchExpressions</code></a> field matches against the value(s). The <code class="language-plaintext highlighter-rouge">matchName</code> field consists of a single expression which is evaulated against the name of each element of the specified feature.</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      <span class="na">matchName</span><span class="pi">:</span>
        <span class="na">op</span><span class="pi">:</span> <span class="s">&lt;op&gt;</span>
        <span class="na">value</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s">&lt;value-1&gt;</span>
          <span class="pi">-</span> <span class="s">...</span>
</code></pre></div></div> <p>The behavior of <code class="language-plaintext highlighter-rouge">matchName</code> depends on the <a href="#feature-types">feature type</a>:</p> <ul> <li>for <em>flag</em> and <em>attribute</em> features the expression is evaluated against the name of each element</li> <li>for <em>instance</em> features the expression is evaluated against the name of each attribute, for each element (instance) separately (matches if the attributes of any of the elements satisfy the expression)</li> </ul> <p>The <code class="language-plaintext highlighter-rouge">op</code> field specifies the operator to apply. Same operators as for <a href="#matchexpressions"><code class="language-plaintext highlighter-rouge">matchExpressions</code></a> above are available.</p> <div class="table-wrapper"><table> <thead> <tr> <th>Operator</th> <th>Number of values</th> <th>Matches</th> </tr> </thead> <tbody> <tr> <td><code class="language-plaintext highlighter-rouge">In</code></td> <td>1 or greater</td> <td>All name is equal to one of the values</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">NotIn</code></td> <td>1 or greater</td> <td>All name that is not equal to any of the values</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">InRegexp</code></td> <td>1 or greater</td> <td>All name that matches any of the values (treated as regexps)</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">Exists</code></td> <td>0</td> <td>All elements</td> </tr> </tbody> </table></div> <p>Other operators are not practical with <code class="language-plaintext highlighter-rouge">matchName</code> (<code class="language-plaintext highlighter-rouge">DoesNotExist</code> never matches; <code class="language-plaintext highlighter-rouge">Gt</code>,<code class="language-plaintext highlighter-rouge">Lt</code> and <code class="language-plaintext highlighter-rouge">GtLt</code> are only usable if feature names are integers; <code class="language-plaintext highlighter-rouge">IsTrue</code> and <code class="language-plaintext highlighter-rouge">IsFalse</code> are only usable if the feature name is <code class="language-plaintext highlighter-rouge">true</code> or <code class="language-plaintext highlighter-rouge">false</code>).</p> <p>The <code class="language-plaintext highlighter-rouge">value</code> field is a list of string arguments to the operator.</p> <p>An example:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      <span class="na">matchFeatures</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">feature</span><span class="pi">:</span> <span class="s">cpu.cpuid</span>
          <span class="na">matchName</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">op</span><span class="pi">:</span> <span class="nv">InRegexp</span><span class="pi">,</span> <span class="nv">value</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">^AVX"</span><span class="pi">]}</span>
</code></pre></div></div> <p>The snippet above would match if any CPUID feature starting with AVX is present (e.g. AVX1 or AVX2 or AVX512F etc).</p> <h4 id="matchany"> <a href="#matchany" class="anchor-heading" aria-labelledby="matchany"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> matchAny </h4> <p>The <code class="language-plaintext highlighter-rouge">.matchAny</code> field is a list of of <a href="#matchfeatures"><code class="language-plaintext highlighter-rouge">matchFeatures</code></a> matchers. A logical OR is applied over the matchers, i.e. at least one of them must match for the rule to trigger.</p> <p>Consider the following example:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      <span class="na">matchAny</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">matchFeatures</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">feature</span><span class="pi">:</span> <span class="s">kernel.loadedmodule</span>
              <span class="na">matchExpressions</span><span class="pi">:</span>
                <span class="na">kmod-1</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">op</span><span class="pi">:</span> <span class="nv">Exists</span><span class="pi">}</span>
            <span class="pi">-</span> <span class="na">feature</span><span class="pi">:</span> <span class="s">pci.device</span>
              <span class="na">matchExpressions</span><span class="pi">:</span>
                <span class="na">vendor</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">op</span><span class="pi">:</span> <span class="nv">In</span><span class="pi">,</span> <span class="nv">value</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">0eee"</span><span class="pi">]}</span>
                <span class="na">class</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">op</span><span class="pi">:</span> <span class="nv">In</span><span class="pi">,</span> <span class="nv">value</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">0200"</span><span class="pi">]}</span>
        <span class="pi">-</span> <span class="na">matchFeatures</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">feature</span><span class="pi">:</span> <span class="s">kernel.loadedmodule</span>
              <span class="na">matchExpressions</span><span class="pi">:</span>
                <span class="na">kmod-2</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">op</span><span class="pi">:</span> <span class="nv">Exists</span><span class="pi">}</span>
            <span class="pi">-</span> <span class="na">feature</span><span class="pi">:</span> <span class="s">pci.device</span>
              <span class="na">matchExpressions</span><span class="pi">:</span>
                <span class="na">vendor</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">op</span><span class="pi">:</span> <span class="nv">In</span><span class="pi">,</span> <span class="nv">value</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">0fff"</span><span class="pi">]}</span>
                <span class="na">class</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">op</span><span class="pi">:</span> <span class="nv">In</span><span class="pi">,</span> <span class="nv">value</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">0200"</span><span class="pi">]}</span>
</code></pre></div></div> <p>This matches if kernel module kmod-1 is loaded and a network controller from vendor 0eee is present, OR, if kernel module kmod-2 has been loaded and a network controller from vendor 0fff is present (OR both of these conditions are true).</p> <h3 id="available-features"> <a href="#available-features" class="anchor-heading" aria-labelledby="available-features"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Available features </h3> <p>The following features are available for matching:</p> <div class="table-wrapper"><table> <thead> <tr> <th>Feature</th> <th><a href="#feature-types">Feature types</a></th> <th>Elements</th> <th>Value type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><strong><code class="language-plaintext highlighter-rouge">cpu.cpuid</code></strong></td> <td>flag</td> <td> </td> <td> </td> <td>Supported CPU capabilities</td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">&lt;cpuid-flag&gt;</code></strong></td> <td> </td> <td>CPUID flag is present</td> </tr> <tr> <td> </td> <td>attribute</td> <td> </td> <td> </td> <td>CPU capability attributes</td> </tr> <tr> <td> </td> <td> </td> <td><strong>AVX10_VERSION</strong></td> <td>int</td> <td>AVX10 vector ISA version (if supported)</td> </tr> <tr> <td><strong><code class="language-plaintext highlighter-rouge">cpu.cstate</code></strong></td> <td>attribute</td> <td> </td> <td> </td> <td>Status of cstates in the intel_idle cpuidle driver</td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">enabled</code></strong></td> <td>bool</td> <td>‘true’ if cstates are set, otherwise ‘false’. Does not exist of intel_idle driver is not active.</td> </tr> <tr> <td><strong><code class="language-plaintext highlighter-rouge">cpu.model</code></strong></td> <td>attribute</td> <td> </td> <td> </td> <td>CPU model related attributes</td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">family</code></strong></td> <td>int</td> <td>CPU family</td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">vendor_id</code></strong></td> <td>string</td> <td>CPU vendor ID</td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">id</code></strong></td> <td>int</td> <td>CPU model ID</td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">hypervisor</code></strong></td> <td>string</td> <td>Hypervisor type information from <code class="language-plaintext highlighter-rouge">/proc/sysinfo</code> (s390x-only feature)</td> </tr> <tr> <td><strong><code class="language-plaintext highlighter-rouge">cpu.pstate</code></strong></td> <td>attribute</td> <td> </td> <td> </td> <td>State of the Intel pstate driver. Does not exist if the driver is not enabled.</td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">status</code></strong></td> <td>string</td> <td>Status of the driver, possible values are ‘active’ and ‘passive’</td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">turbo</code></strong></td> <td>bool</td> <td>‘true’ if turbo frequencies are enabled, otherwise ‘false’</td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">scaling</code></strong></td> <td>string</td> <td>Active scaling_governor, possible values are ‘powersave’ or ‘performance’.</td> </tr> <tr> <td><strong><code class="language-plaintext highlighter-rouge">cpu.rdt</code></strong></td> <td>attribute</td> <td> </td> <td> </td> <td>Intel RDT capabilities supported by the system</td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">&lt;rdt-flag&gt;</code></strong></td> <td> </td> <td>RDT capability is supported, see <a href="#intel-rdt-flags">RDT flags</a> for details</td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">RDTL3CA_NUM_CLOSID</code></strong></td> <td>int</td> <td>The number or available CLOSID (Class of service ID) for Intel L3 Cache Allocation Technology</td> </tr> <tr> <td><strong><code class="language-plaintext highlighter-rouge">cpu.security</code></strong></td> <td>attribute</td> <td> </td> <td> </td> <td>Features related to security and trusted execution environments</td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">sgx.enabled</code></strong></td> <td>bool</td> <td><code class="language-plaintext highlighter-rouge">true</code> if Intel SGX (Software Guard Extensions) has been enabled, otherwise does not exist</td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">sgx.epc</code></strong></td> <td>int</td> <td>The total amount Intel SGX Encrypted Page Cache memory in bytes. It’s only present if <code class="language-plaintext highlighter-rouge">sgx.enabled</code> is <code class="language-plaintext highlighter-rouge">true</code>.</td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">se.enabled</code></strong></td> <td>bool</td> <td><code class="language-plaintext highlighter-rouge">true</code> if IBM Secure Execution for Linux is available and has been enabled, otherwise does not exist</td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">tdx.enabled</code></strong></td> <td>bool</td> <td><code class="language-plaintext highlighter-rouge">true</code> if Intel TDX (Trusted Domain Extensions) is available on the host and has been enabled, otherwise does not exist</td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">tdx.total_keys</code></strong></td> <td>int</td> <td>The total amount of keys an Intel TDX (Trusted Domain Extensions) host can provide. It’s only present if <code class="language-plaintext highlighter-rouge">tdx.enabled</code> is <code class="language-plaintext highlighter-rouge">true</code>.</td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">tdx.protected</code></strong></td> <td>bool</td> <td><code class="language-plaintext highlighter-rouge">true</code> if a guest VM was started using Intel TDX (Trusted Domain Extensions), otherwise does not exist.</td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">sev.enabled</code></strong></td> <td>bool</td> <td><code class="language-plaintext highlighter-rouge">true</code> if AMD SEV (Secure Encrypted Virtualization) is available on the host and has been enabled, otherwise does not exist</td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">sev.es.enabled</code></strong></td> <td>bool</td> <td><code class="language-plaintext highlighter-rouge">true</code> if AMD SEV-ES (Encrypted State supported) is available on the host and has been enabled, otherwise does not exist</td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">sev.snp.enabled</code></strong></td> <td>bool</td> <td><code class="language-plaintext highlighter-rouge">true</code> if AMD SEV-SNP (Secure Nested Paging supported) is available on the host and has been enabled, otherwise does not exist</td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">sev.asids</code></strong></td> <td>int</td> <td>The total amount of AMD SEV address-space identifiers (ASIDs), based on the <code class="language-plaintext highlighter-rouge">/sys/fs/cgroup/misc.capacity</code> information.</td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">sev.encrypted_state_ids</code></strong></td> <td>int</td> <td>The total amount of AMD SEV-ES and SEV-SNP supported, based on the <code class="language-plaintext highlighter-rouge">/sys/fs/cgroup/misc.capacity</code> information.</td> </tr> <tr> <td><strong><code class="language-plaintext highlighter-rouge">cpu.sst</code></strong></td> <td>attribute</td> <td> </td> <td> </td> <td>Intel SST (Speed Select Technology) capabilities</td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">bf.enabled</code></strong></td> <td>bool</td> <td><code class="language-plaintext highlighter-rouge">true</code> if Intel SST-BF (Intel Speed Select Technology - Base frequency) has been enabled, otherwise does not exist</td> </tr> <tr> <td><strong><code class="language-plaintext highlighter-rouge">cpu.topology</code></strong></td> <td>attribute</td> <td> </td> <td> </td> <td>CPU topology related features</td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">hardware_multithreading</code></strong></td> <td>bool</td> <td>Hardware multithreading, such as Intel HTT, is enabled</td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">socket_count</code></strong></td> <td>int</td> <td>Number of CPU Sockets</td> </tr> <tr> <td><strong><code class="language-plaintext highlighter-rouge">cpu.coprocessor</code></strong></td> <td>attribute</td> <td> </td> <td> </td> <td>CPU Coprocessor related features</td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">nx_gzip</code></strong></td> <td>bool</td> <td>Nest Accelerator GZIP support is enabled</td> </tr> <tr> <td><strong><code class="language-plaintext highlighter-rouge">kernel.config</code></strong></td> <td>attribute</td> <td> </td> <td> </td> <td>Kernel configuration options</td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">&lt;config-flag&gt;</code></strong></td> <td>string</td> <td>Value of the kconfig option</td> </tr> <tr> <td><strong><code class="language-plaintext highlighter-rouge">kernel.loadedmodule</code></strong></td> <td>flag</td> <td> </td> <td> </td> <td>Kernel modules loaded on the node as reported by <code class="language-plaintext highlighter-rouge">/proc/modules</code></td> </tr> <tr> <td><strong><code class="language-plaintext highlighter-rouge">kernel.enabledmodule</code></strong></td> <td>flag</td> <td> </td> <td> </td> <td>Kernel modules loaded on the node and available as built-ins as reported by <code class="language-plaintext highlighter-rouge">modules.builtin</code></td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">mod-name</code></strong></td> <td> </td> <td>Kernel module <code class="language-plaintext highlighter-rouge">&lt;mod-name&gt;</code> is loaded</td> </tr> <tr> <td><strong><code class="language-plaintext highlighter-rouge">kernel.selinux</code></strong></td> <td>attribute</td> <td> </td> <td> </td> <td>Kernel SELinux related features</td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">enabled</code></strong></td> <td>bool</td> <td><code class="language-plaintext highlighter-rouge">true</code> if SELinux has been enabled and is in enforcing mode, otherwise <code class="language-plaintext highlighter-rouge">false</code></td> </tr> <tr> <td><strong><code class="language-plaintext highlighter-rouge">kernel.version</code></strong></td> <td>attribute</td> <td> </td> <td> </td> <td>Kernel version information</td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">full</code></strong></td> <td>string</td> <td>Full kernel version (e.g. ‘4.5.6-7-g123abcde’)</td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">major</code></strong></td> <td>int</td> <td>First component of the kernel version (e.g. ‘4’)</td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">minor</code></strong></td> <td>int</td> <td>Second component of the kernel version (e.g. ‘5’)</td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">revision</code></strong></td> <td>int</td> <td>Third component of the kernel version (e.g. ‘6’)</td> </tr> <tr> <td><strong><code class="language-plaintext highlighter-rouge">local.label</code></strong></td> <td>attribute</td> <td> </td> <td> </td> <td>Labels from feature files, i.e. labels from the <a href="#local-feature-source"><em>local</em> feature source</a></td> </tr> <tr> <td><strong><code class="language-plaintext highlighter-rouge">local.feature</code></strong></td> <td>attribute</td> <td> </td> <td> </td> <td>Features from feature files, i.e. features from the <a href="#local-feature-source"><em>local</em> feature source</a></td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">&lt;label-name&gt;</code></strong></td> <td>string</td> <td>Label <code class="language-plaintext highlighter-rouge">&lt;label-name&gt;</code> created by the local feature source, value equals the value of the label</td> </tr> <tr> <td><strong><code class="language-plaintext highlighter-rouge">memory.nv</code></strong></td> <td>instance</td> <td> </td> <td> </td> <td>NVDIMM devices present in the system</td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">&lt;sysfs-attribute&gt;</code></strong></td> <td>string</td> <td>Value of the sysfs device attribute, available attributes: <code class="language-plaintext highlighter-rouge">devtype</code>, <code class="language-plaintext highlighter-rouge">mode</code></td> </tr> <tr> <td><strong><code class="language-plaintext highlighter-rouge">memory.numa</code></strong></td> <td>attribute</td> <td> </td> <td> </td> <td>NUMA nodes</td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">is_numa</code></strong></td> <td>bool</td> <td><code class="language-plaintext highlighter-rouge">true</code> if NUMA architecture, <code class="language-plaintext highlighter-rouge">false</code> otherwise</td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">node_count</code></strong></td> <td>int</td> <td>Number of NUMA nodes</td> </tr> <tr> <td><strong><code class="language-plaintext highlighter-rouge">memory.swap</code></strong></td> <td>attribute</td> <td> </td> <td> </td> <td>Swap enabled on node</td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">enabled</code></strong></td> <td>bool</td> <td><code class="language-plaintext highlighter-rouge">true</code> if swap partition detected, <code class="language-plaintext highlighter-rouge">false</code> otherwise</td> </tr> <tr> <td><strong><code class="language-plaintext highlighter-rouge">memory.hugepages</code></strong></td> <td>attribute</td> <td> </td> <td> </td> <td>Discovery of supported huge pages size on node</td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">enabled</code></strong></td> <td>bool</td> <td><code class="language-plaintext highlighter-rouge">true</code> if total number of huge pages (of any page size) have been configured, otherwise <code class="language-plaintext highlighter-rouge">false</code></td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">hugepages-&lt;page-size&gt;</code></strong></td> <td>string</td> <td>Total number of huge pages (e.g., <code class="language-plaintext highlighter-rouge">hugepages-1Gi=16</code>)</td> </tr> <tr> <td><strong><code class="language-plaintext highlighter-rouge">network.device</code></strong></td> <td>instance</td> <td> </td> <td> </td> <td>Physical (non-virtual) network interfaces present in the system</td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">name</code></strong></td> <td>string</td> <td>Name of the network interface</td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">&lt;sysfs-attribute&gt;</code></strong></td> <td>string</td> <td>Sysfs network interface attribute, available attributes: <code class="language-plaintext highlighter-rouge">operstate</code>, <code class="language-plaintext highlighter-rouge">speed</code>, <code class="language-plaintext highlighter-rouge">sriov_numvfs</code>, <code class="language-plaintext highlighter-rouge">sriov_totalvfs</code>, <code class="language-plaintext highlighter-rouge">mtu</code></td> </tr> <tr> <td><strong><code class="language-plaintext highlighter-rouge">network.virtual</code></strong></td> <td>instance</td> <td> </td> <td> </td> <td>Virtual network interfaces present in the system</td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">name</code></strong></td> <td>string</td> <td>Name of the network interface</td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">&lt;sysfs-attribute&gt;</code></strong></td> <td>string</td> <td>Sysfs network interface attribute, available attributes: <code class="language-plaintext highlighter-rouge">operstate</code>, <code class="language-plaintext highlighter-rouge">speed</code>, <code class="language-plaintext highlighter-rouge">mtu</code></td> </tr> <tr> <td><strong><code class="language-plaintext highlighter-rouge">pci.device</code></strong></td> <td>instance</td> <td> </td> <td> </td> <td>PCI devices present in the system</td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">&lt;sysfs-attribute&gt;</code></strong></td> <td>string</td> <td>Value of the sysfs device attribute, available attributes: <code class="language-plaintext highlighter-rouge">class</code>, <code class="language-plaintext highlighter-rouge">vendor</code>, <code class="language-plaintext highlighter-rouge">device</code>, <code class="language-plaintext highlighter-rouge">subsystem_vendor</code>, <code class="language-plaintext highlighter-rouge">subsystem_device</code>, <code class="language-plaintext highlighter-rouge">sriov_totalvfs</code>, <code class="language-plaintext highlighter-rouge">iommu_group/type</code>, <code class="language-plaintext highlighter-rouge">iommu/intel-iommu/version</code></td> </tr> <tr> <td><strong><code class="language-plaintext highlighter-rouge">storage.block</code></strong></td> <td>instance</td> <td> </td> <td> </td> <td>Block storage devices present in the system</td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">name</code></strong></td> <td>string</td> <td>Name of the block device</td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">&lt;sysfs-attribute&gt;</code></strong></td> <td>string</td> <td>Sysfs network interface attribute, available attributes: <code class="language-plaintext highlighter-rouge">dax</code>, <code class="language-plaintext highlighter-rouge">rotational</code>, <code class="language-plaintext highlighter-rouge">nr_zones</code>, <code class="language-plaintext highlighter-rouge">zoned</code></td> </tr> <tr> <td><strong><code class="language-plaintext highlighter-rouge">system.osrelease</code></strong></td> <td>attribute</td> <td> </td> <td> </td> <td>System identification data from <code class="language-plaintext highlighter-rouge">/etc/os-release</code></td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">&lt;parameter&gt;</code></strong></td> <td>string</td> <td>One parameter from <code class="language-plaintext highlighter-rouge">/etc/os-release</code></td> </tr> <tr> <td><strong><code class="language-plaintext highlighter-rouge">system.dmiid</code></strong></td> <td>attribute</td> <td> </td> <td> </td> <td>DMI identification data from <code class="language-plaintext highlighter-rouge">/sys/devices/virtual/dmi/id/</code></td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">sys_vendor</code></strong></td> <td>string</td> <td>Vendor name from <code class="language-plaintext highlighter-rouge">/sys/devices/virtual/dmi/id/sys_vendor</code></td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">product_name</code></strong></td> <td>string</td> <td>Product name from <code class="language-plaintext highlighter-rouge">/sys/devices/virtual/dmi/id/product_name</code></td> </tr> <tr> <td><strong><code class="language-plaintext highlighter-rouge">system.name</code></strong></td> <td>attribute</td> <td> </td> <td> </td> <td>System name information</td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">nodename</code></strong></td> <td>string</td> <td>Name of the kubernetes node object</td> </tr> <tr> <td><strong><code class="language-plaintext highlighter-rouge">usb.device</code></strong></td> <td>instance</td> <td> </td> <td> </td> <td>USB devices present in the system</td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">&lt;sysfs-attribute&gt;</code></strong></td> <td>string</td> <td>Value of the sysfs device attribute, available attributes: <code class="language-plaintext highlighter-rouge">class</code>, <code class="language-plaintext highlighter-rouge">vendor</code>, <code class="language-plaintext highlighter-rouge">device</code>, <code class="language-plaintext highlighter-rouge">serial</code></td> </tr> <tr> <td><strong><code class="language-plaintext highlighter-rouge">rule.matched</code></strong></td> <td>attribute</td> <td> </td> <td> </td> <td>Previously matched rules</td> </tr> <tr> <td> </td> <td> </td> <td><strong><code class="language-plaintext highlighter-rouge">&lt;label-or-var&gt;</code></strong></td> <td>string</td> <td>Label or var from a preceding rule that matched</td> </tr> </tbody> </table></div> <h4 id="intel-rdt-flags"> <a href="#intel-rdt-flags" class="anchor-heading" aria-labelledby="intel-rdt-flags"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Intel RDT flags </h4> <div class="table-wrapper"><table> <thead> <tr> <th>Flag</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td>RDTMON</td> <td>Intel RDT Monitoring Technology</td> </tr> <tr> <td>RDTCMT</td> <td>Intel Cache Monitoring (CMT)</td> </tr> <tr> <td>RDTMBM</td> <td>Intel Memory Bandwidth Monitoring (MBM)</td> </tr> <tr> <td>RDTL3CA</td> <td>Intel L3 Cache Allocation Technology</td> </tr> <tr> <td>RDTl2CA</td> <td>Intel L2 Cache Allocation Technology</td> </tr> <tr> <td>RDTMBA</td> <td>Intel Memory Bandwidth Allocation (MBA) Technology</td> </tr> </tbody> </table></div> <h3 id="templating"> <a href="#templating" class="anchor-heading" aria-labelledby="templating"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Templating </h3> <p>Rules support template-based creation of labels and vars with the <code class="language-plaintext highlighter-rouge">.labelsTemplate</code> and <code class="language-plaintext highlighter-rouge">.varsTemplate</code> fields. These makes it possible to dynamically generate labels and vars based on the features that matched.</p> <p>The template must expand into a simple format with <code class="language-plaintext highlighter-rouge">&lt;key&gt;=&lt;value&gt;</code> pairs separated by newline.</p> <p>Consider the following example: <!-- --></p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="na">labelsTemplate</span><span class="pi">:</span> <span class="pi">|</span>
      <span class="s">{{ range .pci.device }}vendor-{{ .class }}-{{ .device }}.present=true</span>
      <span class="s">{{ end }}</span>
    <span class="na">matchFeatures</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">feature</span><span class="pi">:</span> <span class="s">pci.device</span>
        <span class="na">matchExpressions</span><span class="pi">:</span>
          <span class="na">class</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">op</span><span class="pi">:</span> <span class="nv">InRegexp</span><span class="pi">,</span> <span class="nv">value</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">^02"</span><span class="pi">]}</span>
          <span class="na">vendor</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">0fff"</span><span class="pi">]</span>
</code></pre></div></div> <!-- --> <p>The rule above will create individual labels <code class="language-plaintext highlighter-rouge">feature.node.kubernetes.io/vendor-&lt;class-id&gt;-&lt;device-id&gt;.present=true</code> for each network controller device (device class starting with 02) from vendor 0fff.</p> <p>All the matched features of each feature matcher term under <code class="language-plaintext highlighter-rouge">matchFeatures</code> fields are available for the template engine. Matched features can be referenced with <code class="language-plaintext highlighter-rouge">{{ .&lt;feature-name&gt; }}</code> in the template, and the available data could be described in yaml as follows:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">.</span>
  <span class="s">&lt;key-feature&gt;</span><span class="err">:</span>
    <span class="pi">-</span> <span class="na">Name</span><span class="pi">:</span> <span class="s">&lt;matched-key&gt;</span>
    <span class="pi">-</span> <span class="s">...</span>

  <span class="na">&lt;value-feature&gt;</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">Name</span><span class="pi">:</span> <span class="s">&lt;matched-key&gt;</span>
      <span class="na">Value</span><span class="pi">:</span> <span class="s">&lt;matched-value&gt;</span>
    <span class="pi">-</span> <span class="s">...</span>

  <span class="na">&lt;instance-feature&gt;</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">&lt;attribute-1-name&gt;</span><span class="pi">:</span> <span class="s">&lt;attribute-1-value&gt;</span>
      <span class="na">&lt;attribute-2-name&gt;</span><span class="pi">:</span> <span class="s">&lt;attribute-2-value&gt;</span>
      <span class="s">...</span>
    <span class="pi">-</span> <span class="s">...</span>
</code></pre></div></div> <p>That is, the per-feature data is a list of objects whose data fields depend on the type of the feature:</p> <ul> <li>for <em>flag</em> features only ‘Name’ is available</li> <li>for <em>value</em> features ‘Name’ and ‘Value’ are available</li> <li>for <em>instance</em> features all attributes of the matched instance are available</li> </ul> <p>A simple example of a template utilizing name and value from an <em>attribute</em> feature: <!-- --></p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="na">labelsTemplate</span><span class="pi">:</span> <span class="pi">|</span>
      <span class="s">{{ range .system.osrelease }}system-{{ .Name }}={{ .Value }}</span>
      <span class="s">{{ end }}</span>
    <span class="na">matchFeatures</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">feature</span><span class="pi">:</span> <span class="s">system.osRelease</span>
        <span class="na">matchExpressions</span><span class="pi">:</span>
          <span class="na">ID</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">op</span><span class="pi">:</span> <span class="nv">Exists</span><span class="pi">}</span>
          <span class="na">VERSION_ID.major</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">op</span><span class="pi">:</span> <span class="nv">Exists</span><span class="pi">}</span>
</code></pre></div></div> <!-- --> <blockquote> <p><strong>NOTE:</strong>If both <code class="language-plaintext highlighter-rouge">matchExpressions</code> and <code class="language-plaintext highlighter-rouge">matchName</code> for a feature matcher term (see <a href="#matchfeatures"><code class="language-plaintext highlighter-rouge">matchFeatures</code></a>) is specified, the list of matched features (for the template engine) is the union from both of these. <!-- note #2 --> <strong>NOTE:</strong> In case of matchAny is specified, the template is executed separately against each individual <code class="language-plaintext highlighter-rouge">matchFeatures</code> field and the final set of labels will be superset of all these separate template expansions. E.g. consider the following:</p> </blockquote> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">&lt;name&gt;</span>
    <span class="na">labelsTemplate</span><span class="pi">:</span> <span class="s">&lt;template&gt;</span>
    <span class="na">matchFeatures</span><span class="pi">:</span> <span class="s">&lt;matcher#1&gt;</span>
    <span class="na">matchAny</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">matchFeatures</span><span class="pi">:</span> <span class="s">&lt;matcher#2&gt;</span>
      <span class="pi">-</span> <span class="na">matchFeatures</span><span class="pi">:</span> <span class="s">&lt;matcher#3&gt;</span>
</code></pre></div></div> <p>In the example above (assuming the overall result is a match) the template would be executed on matcher#1 as well as on matcher#2 and/or matcher#3 (depending on whether both or only one of them match). All the labels from these separate expansions would be created, i.e. the end result would be a union of all the individual expansions.</p> <p>Rule templates use the Golang <a href="https://pkg.go.dev/text/template">text/template</a> package along with <a href="https://masterminds.github.io/sprig/">Sprig functions</a> and all their functionality (e.g. pipelines and functions) can be used. An example template taking use of the built-in <code class="language-plaintext highlighter-rouge">len</code> function, advertising the number of PCI network controllers from a specific vendor, and using Sprig’s <code class="language-plaintext highlighter-rouge">first</code>, <code class="language-plaintext highlighter-rouge">trim</code> and <code class="language-plaintext highlighter-rouge">substr</code> to advertise the first one’s class: <!-- --></p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="na">labelsTemplate</span><span class="pi">:</span> <span class="pi">|</span>
      <span class="s">num-intel-network-controllers={{ .pci.device | len }}</span>
      <span class="s">first-intel-network-controllers={{ (.pci.device | first).class | trim | substr 0 63 }}</span>
    <span class="na">matchFeatures</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">feature</span><span class="pi">:</span> <span class="s">pci.device</span>
        <span class="na">matchExpressions</span><span class="pi">:</span>
          <span class="na">vendor</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">op</span><span class="pi">:</span> <span class="nv">In</span><span class="pi">,</span> <span class="nv">value</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">8086"</span><span class="pi">]}</span>
          <span class="na">class</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">op</span><span class="pi">:</span> <span class="nv">In</span><span class="pi">,</span> <span class="nv">value</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">0200"</span><span class="pi">]}</span>

</code></pre></div></div> <!-- --> <p>Imaginative template pipelines are possible, but care must be taken to produce understandable and maintainable rule sets.</p> <h3 id="backreferences"> <a href="#backreferences" class="anchor-heading" aria-labelledby="backreferences"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Backreferences </h3> <p>Rules support referencing the output of preceding rules. This enables sophisticated scenarios where multiple rules are combined together to for more complex heuristics than a single rule can provide. The labels and vars created by the execution of preceding rules are available as a special <code class="language-plaintext highlighter-rouge">rule.matched</code> feature.</p> <p>Consider the following configuration:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">my</span><span class="nv"> </span><span class="s">kernel</span><span class="nv"> </span><span class="s">label</span><span class="nv"> </span><span class="s">rule"</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="na">kernel-feature</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
    <span class="na">matchFeatures</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">feature</span><span class="pi">:</span> <span class="s">kernel.version</span>
        <span class="na">matchExpressions</span><span class="pi">:</span>
          <span class="na">major</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">op</span><span class="pi">:</span> <span class="nv">Gt</span><span class="pi">,</span> <span class="nv">value</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">4"</span><span class="pi">]}</span>

  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">my</span><span class="nv"> </span><span class="s">var</span><span class="nv"> </span><span class="s">rule"</span>
    <span class="na">vars</span><span class="pi">:</span>
      <span class="na">nolabel-feature</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
    <span class="na">matchFeatures</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">feature</span><span class="pi">:</span> <span class="s">cpu.cpuid</span>
        <span class="na">matchExpressions</span><span class="pi">:</span>
          <span class="na">AVX512F</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">op</span><span class="pi">:</span> <span class="nv">Exists</span><span class="pi">}</span>
      <span class="pi">-</span> <span class="na">feature</span><span class="pi">:</span> <span class="s">pci.device</span>
        <span class="na">matchExpressions</span><span class="pi">:</span>
          <span class="na">vendor</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">op</span><span class="pi">:</span> <span class="nv">In</span><span class="pi">,</span> <span class="nv">value</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">0fff"</span><span class="pi">]}</span>
          <span class="na">device</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">op</span><span class="pi">:</span> <span class="nv">In</span><span class="pi">,</span> <span class="nv">value</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">1234"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">1235"</span><span class="pi">]}</span>

  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">my</span><span class="nv"> </span><span class="s">high</span><span class="nv"> </span><span class="s">level</span><span class="nv"> </span><span class="s">feature</span><span class="nv"> </span><span class="s">rule"</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="na">high-level-feature</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
    <span class="na">matchFeatures</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">feature</span><span class="pi">:</span> <span class="s">rule.matched</span>
        <span class="na">matchExpressions</span><span class="pi">:</span>
          <span class="na">kernel-feature</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">op</span><span class="pi">:</span> <span class="nv">IsTrue</span><span class="pi">}</span>
          <span class="na">nolabel-feature</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">op</span><span class="pi">:</span> <span class="nv">IsTrue</span><span class="pi">}</span>
</code></pre></div></div> <p>The <code class="language-plaintext highlighter-rouge">feature.node.kubernetes.io/high-level-feature = true</code> label depends on the two previous rules.</p> <p>Note that when referencing rules across multiple <a href="#nodefeaturerule-custom-resource"><code class="language-plaintext highlighter-rouge">NodeFeatureRule</code></a> objects attention must be paid to the ordering. <code class="language-plaintext highlighter-rouge">NodeFeatureRule</code> objects are processed in alphabetical order (based on their <code class="language-plaintext highlighter-rouge">.metadata.name</code>).</p> <h3 id="examples"> <a href="#examples" class="anchor-heading" aria-labelledby="examples"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Examples </h3> <p>Some more configuration examples below.</p> <p>Match certain CPUID features:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">example</span><span class="nv"> </span><span class="s">cpuid</span><span class="nv"> </span><span class="s">rule"</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="na">my-special-cpu-feature</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
    <span class="na">matchFeatures</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">feature</span><span class="pi">:</span> <span class="s">cpu.cpuid</span>
        <span class="na">matchExpressions</span><span class="pi">:</span>
          <span class="na">AESNI</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">op</span><span class="pi">:</span> <span class="nv">Exists</span><span class="pi">}</span>
          <span class="na">AVX</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">op</span><span class="pi">:</span> <span class="nv">Exists</span><span class="pi">}</span>
</code></pre></div></div> <p>Require a certain loaded kernel module and OS version:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">my</span><span class="nv"> </span><span class="s">multi-feature</span><span class="nv"> </span><span class="s">rule"</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="na">my-special-multi-feature</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
    <span class="na">matchFeatures</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">feature</span><span class="pi">:</span> <span class="s">kernel.loadedmodule</span>
        <span class="na">matchExpressions</span><span class="pi">:</span>
          <span class="na">e1000</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">op</span><span class="pi">:</span> <span class="nv">Exists</span><span class="pi">}</span>
      <span class="pi">-</span> <span class="na">feature</span><span class="pi">:</span> <span class="s">system.osrelease</span>
        <span class="na">matchExpressions</span><span class="pi">:</span>
          <span class="na">NAME</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">op</span><span class="pi">:</span> <span class="nv">InRegexp</span><span class="pi">,</span> <span class="nv">values</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">^openSUSE"</span><span class="pi">]}</span>
          <span class="na">VERSION_ID.major</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">op</span><span class="pi">:</span> <span class="nv">Gt</span><span class="pi">,</span> <span class="nv">values</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">14"</span><span class="pi">]}</span>
</code></pre></div></div> <p>Require a loaded kernel module and two specific PCI devices (both of which must be present):</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">my</span><span class="nv"> </span><span class="s">multi-device</span><span class="nv"> </span><span class="s">rule"</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="na">my-multi-device-feature</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
    <span class="na">matchFeatures</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">feature</span><span class="pi">:</span> <span class="s">kernel.loadedmodule</span>
        <span class="na">matchExpressions</span><span class="pi">:</span>
          <span class="na">my-driver-module</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">op</span><span class="pi">:</span> <span class="nv">Exists</span><span class="pi">}</span>
      <span class="pi">-</span> <span class="na">pci.device</span><span class="pi">:</span>
          <span class="na">vendor</span><span class="pi">:</span> <span class="s2">"</span><span class="s">0fff"</span>
          <span class="na">device</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1234"</span>
      <span class="pi">-</span> <span class="na">pci.device</span><span class="pi">:</span>
          <span class="na">vendor</span><span class="pi">:</span> <span class="s2">"</span><span class="s">0fff"</span>
          <span class="na">device</span><span class="pi">:</span> <span class="s2">"</span><span class="s">abcd"</span>
</code></pre></div></div> </main> </div> </div> <div class="search-overlay"></div> </div> </body> </html>

<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/node-feature-discovery/master/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/node-feature-discovery/master/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav > ul.nav-list:first-child > li > a, .site-nav > ul.nav-list:first-child > li > ul > li:not(:nth-child(11)) > a, .site-nav > ul.nav-list:first-child > li > ul > li > ul > li a { background-image: none; } .site-nav > ul.nav-list:not(:first-child) a, .site-nav li.external a { background-image: none; } .site-nav > ul.nav-list:first-child > li:nth-child(3) > ul > li:nth-child(11) > a { font-weight: 600; text-decoration: none; }.site-nav > ul.nav-list:first-child > li:nth-child(3) > button svg, .site-nav > ul.nav-list:first-child > li:nth-child(3) > ul > li:nth-child(11) > button svg { transform: rotate(-90deg); }.site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(3) > ul.nav-list, .site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(3) > ul.nav-list > li.nav-list-item:nth-child(11) > ul.nav-list { display: block; } </style> <script src="/node-feature-discovery/master/assets/js/vendor/lunr.min.js"></script> <script src="/node-feature-discovery/master/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Image Compatibility Artifact | Node Feature Discovery</title> <meta name="generator" content="Jekyll v3.10.0" /> <meta property="og:title" content="Image Compatibility Artifact" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Documentation of Node Feature Discovery - a Kubernetes add-on for discovering and advertising hardware features and system configuration in the cluster." /> <meta property="og:description" content="Documentation of Node Feature Discovery - a Kubernetes add-on for discovering and advertising hardware features and system configuration in the cluster." /> <link rel="canonical" href="https://kubernetes-sigs.github.com/node-feature-discovery/master/usage/image-compatibility.html" /> <meta property="og:url" content="https://kubernetes-sigs.github.com/node-feature-discovery/master/usage/image-compatibility.html" /> <meta property="og:site_name" content="Node Feature Discovery" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Image Compatibility Artifact" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Documentation of Node Feature Discovery - a Kubernetes add-on for discovering and advertising hardware features and system configuration in the cluster.","headline":"Image Compatibility Artifact","url":"https://kubernetes-sigs.github.com/node-feature-discovery/master/usage/image-compatibility.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/node-feature-discovery/master/" class="site-title lh-tight"> Node Feature Discovery </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Get started category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/node-feature-discovery/master/get-started/" class="nav-list-link">Get started</a><ul class="nav-list"><li class="nav-list-item"><a href="/node-feature-discovery/master/get-started/introduction.html" class="nav-list-link">Introduction</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/get-started/quick-start.html" class="nav-list-link">Quick start</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Deployment category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/node-feature-discovery/master/deployment/" class="nav-list-link">Deployment</a><ul class="nav-list"><li class="nav-list-item"><a href="/node-feature-discovery/master/deployment/image-variants.html" class="nav-list-link">Image variants</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/deployment/kustomize.html" class="nav-list-link">Kustomize</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/deployment/helm.html" class="nav-list-link">Helm</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/deployment/operator.html" class="nav-list-link">NFD Operator</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/deployment/uninstallation.html" class="nav-list-link">Uninstallation</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/deployment/metrics.html" class="nav-list-link">Metrics</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Usage category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/node-feature-discovery/master/usage/" class="nav-list-link">Usage</a><ul class="nav-list"><li class="nav-list-item"><a href="/node-feature-discovery/master/usage/features.html" class="nav-list-link">Feature labels</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/usage/using-labels.html" class="nav-list-link">Using node labels</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/usage/nfd-master.html" class="nav-list-link">NFD-Master</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/usage/nfd-worker.html" class="nav-list-link">NFD-Worker</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/usage/nfd-topology-updater.html" class="nav-list-link">NFD-Topology-Updater</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/usage/nfd-gc.html" class="nav-list-link">NFD-Garbage-Collector</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/usage/custom-resources.html" class="nav-list-link">CRDs</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/usage/customization-guide.html" class="nav-list-link">Customization guide</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/usage/examples-and-demos.html" class="nav-list-link">Examples and demos</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/usage/kubectl-plugin.html" class="nav-list-link">Kubectl plugin</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/usage/image-compatibility.html" class="nav-list-link">Image Compatibility Artifact</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Reference category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/node-feature-discovery/master/reference/" class="nav-list-link">Reference</a><ul class="nav-list"><li class="nav-list-item"><a href="/node-feature-discovery/master/reference/master-commandline-reference.html" class="nav-list-link">Master cmdline reference</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/reference/worker-commandline-reference.html" class="nav-list-link">Worker cmdline reference</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/reference/master-configuration-reference.html" class="nav-list-link">Master config reference</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/reference/worker-configuration-reference.html" class="nav-list-link">Worker config reference</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/reference/topology-updater-commandline-reference.html" class="nav-list-link">Topology Updater Cmdline Reference</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/reference/topology-updater-configuration-reference.html" class="nav-list-link">Topology-Updater config reference</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/reference/gc-commandline-reference.html" class="nav-list-link">Garbage Collector Cmdline Reference</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/reference/plugin-commandline-reference.html" class="nav-list-link">Kubectl plugin cmdline reference</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/reference/node-feature-client-reference.html" class="nav-list-link">Node Feature client cmdline reference</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/reference/versions.html" class="nav-list-link">Versions</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/reference/feature-gates.html" class="nav-list-link">Feature Gates</a></li></ul></li><li class="nav-list-item"><a href="/node-feature-discovery/master/developer-guide/" class="nav-list-link">Developer guide</a></li><li class="nav-list-item"><a href="/node-feature-discovery/master/contributing/" class="nav-list-link">Contributing</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Node Feature Discovery" aria-label="Search Node Feature Discovery" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <div class="version-dropdown"> <label for="versions">Version:</label> <select id="versions" onchange="location = this.value;"> <script src="/node-feature-discovery/versions.js"></script> <script> var select = document.getElementById('versions'); var items = getVersionListItems(); for (var i=0; i < items.length; i++) { var opt = document.createElement('option'); opt.appendChild(document.createTextNode(items[i].name)); opt.value = items[i].url; select.appendChild(opt); } </script> </select> </div> </div> <div class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/node-feature-discovery/master/usage/">Usage</a></li> <li class="breadcrumb-nav-list-item"><span>Image Compatibility Artifact</span></li> </ol> </nav> <div id="main-content" class="main-content"> <main> <h1 class="no_toc" id="image-compatibility-artifact"> <a href="#image-compatibility-artifact" class="anchor-heading" aria-labelledby="image-compatibility-artifact"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Image Compatibility Artifact </h1> <h2 class="no_toc text-delta" id="table-of-contents"> <a href="#table-of-contents" class="anchor-heading" aria-labelledby="table-of-contents"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Table of contents </h2> <ol id="markdown-toc"> <li><a href="#image-compatibility" id="markdown-toc-image-compatibility">Image Compatibility</a> <ol> <li><a href="#compatibility-specification" id="markdown-toc-compatibility-specification">Compatibility Specification</a></li> <li><a href="#schema" id="markdown-toc-schema">Schema</a></li> <li><a href="#oci-artifact" id="markdown-toc-oci-artifact">OCI Artifact</a></li> <li><a href="#validate-the-host-against-the-image-compatibility-specification" id="markdown-toc-validate-the-host-against-the-image-compatibility-specification">Validate the host against the image compatibility specification</a></li> <li><a href="#validate-the-k8s-cluster-node-with-the-validate-image-job" id="markdown-toc-validate-the-k8s-cluster-node-with-the-validate-image-job">Validate the k8s cluster node with the validate-image Job</a></li> </ol> </li> </ol><hr /> <h2 id="image-compatibility"> <a href="#image-compatibility" class="anchor-heading" aria-labelledby="image-compatibility"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Image Compatibility </h2> <p><strong>Image Compatibility is in the experimental <code class="language-plaintext highlighter-rouge">v1alpha1</code> version.</strong></p> <p>Image compatibility metadata enables container image authors to define their image requirements using a spec similar to <a href="/node-feature-discovery/master/usage/custom-resources.html#nodefeaturegroup">Node Feature Groups</a>. This complementary solution allows features discovered on nodes to be matched directly from images. As a result, container requirements become discoverable and programmable, supporting various consumers and use cases where applications need a specific compatible environment.</p> <h3 id="compatibility-specification"> <a href="#compatibility-specification" class="anchor-heading" aria-labelledby="compatibility-specification"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Compatibility Specification </h3> <p>The compatibility specification is a list of compatibility objects that contain rules similar to <a href="/node-feature-discovery/master/usage/custom-resources.html#nodefeaturegroup">Node Feature Groups</a>, along with additional fields to control the execution of validation between the image and the host.</p> <h3 id="schema"> <a href="#schema" class="anchor-heading" aria-labelledby="schema"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Schema </h3> <ul> <li> <p><strong>version</strong> - <em>string</em><br /> This REQUIRED property specifies the version of the API in use.</p> </li> <li> <p><strong>compatibilities</strong> - <em>array of object</em><br /> This REQUIRED property is a list of compatibility sets.</p> <ul> <li> <p><strong>rules</strong> - <em>object</em><br /> This REQUIRED property is a reference to the spec of the <a href="/node-feature-discovery/master/usage/custom-resources.html#nodefeaturegroup">NodeFeatureGroup API</a>. The spec allows image requirements to be described using the features discovered from NFD sources. For more details, please refer to <a href="/node-feature-discovery/master/usage/custom-resources.html#nodefeaturegroup">the documentation</a>.</p> </li> <li> <p><strong>weight</strong> - <em>int</em><br /> This OPTIONAL property specifies the <a href="https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#node-affinity-weight">node affinity weight</a>.</p> </li> <li> <p><strong>tag</strong> - <em>string</em><br /> This OPTIONAL property allows for the grouping or separation of compatibility sets.</p> </li> <li> <p><strong>description</strong> - <em>string</em><br /> This OPTIONAL property provides a brief description of a compatibility set.</p> </li> </ul> </li> </ul> <h4 id="example"> <a href="#example" class="anchor-heading" aria-labelledby="example"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Example </h4> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s">v1alpha1</span>
<span class="na">compatibilities</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">My</span><span class="nv"> </span><span class="s">image</span><span class="nv"> </span><span class="s">requirements"</span>
  <span class="na">rules</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">kernel</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">cpu"</span>
    <span class="na">matchFeatures</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">feature</span><span class="pi">:</span> <span class="s">kernel.loadedmodule</span>
      <span class="na">matchExpressions</span><span class="pi">:</span>
        <span class="na">vfio-pci</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">op</span><span class="pi">:</span> <span class="nv">Exists</span><span class="pi">}</span>
    <span class="pi">-</span> <span class="na">feature</span><span class="pi">:</span> <span class="s">cpu.model</span>
      <span class="na">matchExpressions</span><span class="pi">:</span>
        <span class="na">vendor_id</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">op</span><span class="pi">:</span> <span class="nv">In</span><span class="pi">,</span> <span class="nv">value</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">Intel"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">AMD"</span><span class="pi">]}</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">one</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">available</span><span class="nv"> </span><span class="s">nics"</span>
    <span class="na">matchAny</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">matchFeatures</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">feature</span><span class="pi">:</span> <span class="s">pci.device</span>
        <span class="na">matchExpressions</span><span class="pi">:</span>
          <span class="na">vendor</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">op</span><span class="pi">:</span> <span class="nv">In</span><span class="pi">,</span> <span class="nv">value</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">0eee"</span><span class="pi">]}</span>
          <span class="na">class</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">op</span><span class="pi">:</span> <span class="nv">In</span><span class="pi">,</span> <span class="nv">value</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">0200"</span><span class="pi">]}</span>
    <span class="pi">-</span> <span class="na">matchFeatures</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">feature</span><span class="pi">:</span> <span class="s">pci.device</span>
        <span class="na">matchExpressions</span><span class="pi">:</span>
          <span class="na">vendor</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">op</span><span class="pi">:</span> <span class="nv">In</span><span class="pi">,</span> <span class="nv">value</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">0fff"</span><span class="pi">]}</span>
          <span class="na">class</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">op</span><span class="pi">:</span> <span class="nv">In</span><span class="pi">,</span> <span class="nv">value</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">0200"</span><span class="pi">]}</span>
</code></pre></div></div> <h3 id="oci-artifact"> <a href="#oci-artifact" class="anchor-heading" aria-labelledby="oci-artifact"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> OCI Artifact </h3> <p>An <a href="https://github.com/opencontainers/image-spec/blob/main/manifest.md#guidelines-for-artifact-usage">OCI artifact</a> is used to store image compatibility metadata. The artifact can be associated with a specific image through <a href="https://github.com/opencontainers/distribution-spec/blob/11b8e3fba7d2d7329513d0cff53058243c334858/spec.md#pushing-manifests-with-subject">the subject field</a> and pushed to the registry along with the image.</p> <p>Example manifest:</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"schemaVersion"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
  </span><span class="nl">"mediaType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"application/vnd.oci.image.manifest.v1+json"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"artifactType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"application/vnd.nfd.image-compatibility.v1alpha1"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"mediaType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"application/vnd.oci.empty.v1+json"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"digest"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sha256:44136fa355b3678a1146ad16f7e8649e94fb4fc21fe77e8310c060f61caaff8a"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"size"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"layers"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"mediaType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"application/vnd.nfd.image-compatibility.spec.v1alpha1+yaml"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"digest"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sha256:4a47f8ae4c713906618413cb9795824d09eeadf948729e213a1ba11a1e31d052"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"size"</span><span class="p">:</span><span class="w"> </span><span class="mi">1710</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"subject"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"mediaType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"application/vnd.oci.image.manifest.v1+json"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"digest"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sha256:5b0bcabd1ed22e9fb1310cf6c2dec7cdef19f0ad69efa1f392e94a4333501270"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"size"</span><span class="p">:</span><span class="w"> </span><span class="mi">7682</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"annotations"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"oci.opencontainers.image.created"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2024-03-27T08:08:08Z"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <h4 id="attach-the-artifact-to-the-image"> <a href="#attach-the-artifact-to-the-image" class="anchor-heading" aria-labelledby="attach-the-artifact-to-the-image"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Attach the artifact to the image </h4> <p>Create an image compatibility specification for the image, then install the <a href="https://github.com/oras-project/oras/">ORAS</a> tool and execute <code class="language-plaintext highlighter-rouge">oras attach</code> command.</p> <p>Example:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>oras attach <span class="nt">--artifact-type</span> application/vnd.nfd.image-compatibility.v1alpha1 <span class="se">\</span>
&lt;image-url&gt; &lt;path-to-spec&gt;.yaml:application/vnd.nfd.image-compatibility.spec.v1alpha1+yaml
</code></pre></div></div> <p><strong>Note</strong>: The attach command is planned to be integrated into the <code class="language-plaintext highlighter-rouge">nfd</code> client tool. This will streamline the process, allowing you to perform the operation directly within the tool rather than using a separate command.</p> <h3 id="validate-the-host-against-the-image-compatibility-specification"> <a href="#validate-the-host-against-the-image-compatibility-specification" class="anchor-heading" aria-labelledby="validate-the-host-against-the-image-compatibility-specification"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Validate the host against the image compatibility specification </h3> <ol> <li>Build <code class="language-plaintext highlighter-rouge">nfd</code> client: <code class="language-plaintext highlighter-rouge">make build</code></li> <li>Run <code class="language-plaintext highlighter-rouge">./bin/nfd compat validate-node --image &lt;image-url&gt;</code></li> </ol> <p>For more information about the available commands and flags, refer to <a href="/node-feature-discovery/master/reference/node-feature-client-reference.html">the client documentation</a>.</p> <h3 id="validate-the-k8s-cluster-node-with-the-validate-image-job"> <a href="#validate-the-k8s-cluster-node-with-the-validate-image-job" class="anchor-heading" aria-labelledby="validate-the-k8s-cluster-node-with-the-validate-image-job"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Validate the k8s cluster node with the validate-image Job </h3> <p><strong>Note</strong>: This does not require installation of NFD master and workers. Additionally, public registry certificates must be included in the job. In the example below, this is done using hostPath, but it can be done using any Kubernetes-supported method.</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">batch/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Job</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">validate-image</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">backoffLimit</span><span class="pi">:</span> <span class="m">1</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">restartPolicy</span><span class="pi">:</span> <span class="s">Never</span>
      <span class="na">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">image-compatibility</span>
        <span class="na">securityContext</span><span class="pi">:</span>
          <span class="na">allowPrivilegeEscalation</span><span class="pi">:</span> <span class="no">false</span>
          <span class="na">capabilities</span><span class="pi">:</span>
            <span class="na">drop</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">ALL</span>
          <span class="na">readOnlyRootFilesystem</span><span class="pi">:</span> <span class="no">true</span>
          <span class="na">runAsNonRoot</span><span class="pi">:</span> <span class="no">true</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">&lt;image-with-nfd-client&gt;</span>
        <span class="na">command</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">nfd"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">compat"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">validate-node"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">--image"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">&lt;image-to-be-validated&gt;"</span><span class="pi">]</span>
        <span class="na">volumeMounts</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/host-boot</span>
            <span class="na">name</span><span class="pi">:</span> <span class="s">host-boot</span>  
            <span class="na">readOnly</span><span class="pi">:</span> <span class="no">true</span>
          <span class="pi">-</span> <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/host-etc/os-release</span>
            <span class="na">name</span><span class="pi">:</span> <span class="s">host-os-release</span>
            <span class="na">readOnly</span><span class="pi">:</span> <span class="no">true</span>
          <span class="pi">-</span> <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/host-sys</span>
            <span class="na">name</span><span class="pi">:</span> <span class="s">host-sys</span>
            <span class="na">readOnly</span><span class="pi">:</span> <span class="no">true</span>
          <span class="pi">-</span> <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/host-usr/lib</span>
            <span class="na">name</span><span class="pi">:</span> <span class="s">host-usr-lib</span>
            <span class="na">readOnly</span><span class="pi">:</span> <span class="no">true</span>
          <span class="pi">-</span> <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/host-lib</span>
            <span class="na">name</span><span class="pi">:</span> <span class="s">host-lib</span>
            <span class="na">readOnly</span><span class="pi">:</span> <span class="no">true</span>
          <span class="pi">-</span> <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/host-proc</span>
            <span class="na">name</span><span class="pi">:</span> <span class="s">host-proc</span>
            <span class="na">readOnly</span><span class="pi">:</span> <span class="no">true</span>
      <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">hostPath</span><span class="pi">:</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s">/boot</span>
          <span class="na">type</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">host-boot</span>
      <span class="pi">-</span> <span class="na">hostPath</span><span class="pi">:</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s">/etc/os-release</span>
          <span class="na">type</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">host-os-release</span>
      <span class="pi">-</span> <span class="na">hostPath</span><span class="pi">:</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s">/sys</span>
          <span class="na">type</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">host-sys</span>
      <span class="pi">-</span> <span class="na">hostPath</span><span class="pi">:</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s">/usr/lib</span>
          <span class="na">type</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">host-usr-lib</span>
      <span class="pi">-</span> <span class="na">hostPath</span><span class="pi">:</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s">/lib</span>
          <span class="na">type</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">host-lib</span>
      <span class="pi">-</span> <span class="na">hostPath</span><span class="pi">:</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s">/proc</span>
          <span class="na">type</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">host-proc</span>
      <span class="pi">-</span> <span class="na">hostPath</span><span class="pi">:</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s2">"</span><span class="s">&lt;path-to-registry-public-certs&gt;"</span>
          <span class="na">type</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">certs</span>
</code></pre></div></div> </main> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
